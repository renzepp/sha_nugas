<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sha-Desk ğŸ€</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS VARIABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  /* HW Mode - Baby Pink / Light */
  --pk:#f4a0bc; --pkm:#f7bdd0; --pkp:#fff5f9; --pkd:#fde8f0; --cream:#fffaf9;
  --td:#5a2d3e; --tm:#9b5c72; --tl:#c4899d;
  --bdr:#f9d0df; --shd:rgba(244,160,188,0.18);
  --bg:#fff5f9; --bgc:#ffffffdd; --bgs:linear-gradient(160deg,#fff5f9 0%,#fde8f055 100%);
  --hbg:linear-gradient(180deg,#fff8faf0 0%,transparent 100%);
  /* Exam/Purple */
  --ex:#9b6fd4; --exm:#b899e0; --exp:#f5eeff; --exd:#ecdcf8; --exb:#d6b8f5; --exs:rgba(155,111,212,0.18);
}

/* â”€â”€ NIGHT MODE â”€â”€ */
body.night {
  --pk:#e8789a; --pkm:#c4607a; --pkp:#1e0f18; --pkd:#2e1522;
  --cream:#18080f;
  --td:#f5d0e0; --tm:#d490a8; --tl:#8a4060;
  --bdr:#4a1e30; --shd:rgba(232,120,154,0.12);
  --bg:#160810; --bgc:rgba(35,12,22,0.9); --bgs:linear-gradient(160deg,#1e0f18 0%,#2e152244 100%);
  --hbg:linear-gradient(180deg,#1e0f18f0 0%,transparent 100%);
  --ex:#b899e0; --exm:#9b6fd4; --exp:#120a1e; --exd:#1e1230; --exb:#3e2560; --exs:rgba(155,111,212,0.15);
}

/* â”€â”€ EXAM MODE (light) â”€â”€ */
body.exam-mode:not(.night) {
  --bg:#f2ecff; --bgs:linear-gradient(160deg,#f2ecff 0%,#e8d8f855 100%);
  --hbg:linear-gradient(180deg,#f4efffee 0%,transparent 100%);
  --bdr:#d6b8f5; --shd:rgba(155,111,212,0.18);
  --pk:#9b6fd4; --pkm:#b899e0; --pkp:#f2ecff; --pkd:#e8d8f8;
  --td:#2e1460; --tm:#6040b0; --tl:#9470c8;
  --bgc:#f8f4ffee;
}

body.exam-mode.night {
  --bg:#120a1e; --bgc:rgba(28,16,45,0.92); --bgs:linear-gradient(160deg,#1a0e2e 0%,#22103a55 100%);
  --hbg:linear-gradient(180deg,#1a0e2ef0 0%,transparent 100%);
  --bdr:#3e2560; --shd:rgba(155,111,212,0.15);
  --pk:#b899e0; --pkm:#9b6fd4; --pkp:#120a1e; --pkd:#1e1230;
  --td:#e0ccf8; --tm:#b899e0; --tl:#7850a8;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;font-weight:500;background:var(--bg);min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden;transition:background .35s,color .35s;}

/* â”€â”€ COQUETTE WALLPAPER â”€â”€ */
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;transition:opacity .35s;}

/* HW mode wallpaper - light coquette pink WITH motifs */
body:not(.exam-mode):not(.night)::before{
  background:
    radial-gradient(ellipse 55% 35% at 8% 8%,#fde8f0bb 0%,transparent 55%),
    radial-gradient(ellipse 45% 45% at 92% 92%,#f9d0df99 0%,transparent 55%),
    radial-gradient(ellipse 30% 30% at 50% 50%,#fff0f888 0%,transparent 70%),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Ctext x='10' y='38' font-size='22' opacity='0.13' transform='rotate(-18,10,38)'%3E%F0%9F%8E%80%3C/text%3E%3Ctext x='85' y='22' font-size='14' opacity='0.11' transform='rotate(10,85,22)'%3E%F0%9F%8C%B8%3C/text%3E%3Ctext x='152' y='50' font-size='17' opacity='0.10' transform='rotate(20,152,50)'%3E%F0%9F%AA%9E%3C/text%3E%3Ctext x='38' y='88' font-size='15' opacity='0.11' transform='rotate(-12,38,88)'%3E%F0%9F%8E%80%3C/text%3E%3Ctext x='120' y='92' font-size='12' opacity='0.09' transform='rotate(8,120,92)'%3E%F0%9F%8C%B7%3C/text%3E%3Ctext x='178' y='105' font-size='19' opacity='0.12' transform='rotate(-25,178,105)'%3E%F0%9F%AA%9E%3C/text%3E%3Ctext x='18' y='140' font-size='14' opacity='0.10' transform='rotate(15,18,140)'%3E%F0%9F%8C%B8%3C/text%3E%3Ctext x='95' y='152' font-size='23' opacity='0.12' transform='rotate(-8,95,152)'%3E%F0%9F%8E%80%3C/text%3E%3Ctext x='162' y='155' font-size='12' opacity='0.09' transform='rotate(22,162,155)'%3E%F0%9F%8C%B9%3C/text%3E%3Ctext x='50' y='188' font-size='17' opacity='0.11' transform='rotate(-5,50,188)'%3E%F0%9F%AA%9E%3C/text%3E%3Ctext x='132' y='195' font-size='15' opacity='0.10' transform='rotate(12,132,195)'%3E%F0%9F%8C%B8%3C/text%3E%3Ctext x='65' y='62' font-size='11' opacity='0.09' transform='rotate(5,65,62)'%3E%F0%9F%92%9C%3C/text%3E%3Ctext x='142' y='130' font-size='13' opacity='0.09' transform='rotate(-15,142,130)'%3E%F0%9F%AA%B9%3C/text%3E%3C/svg%3E");
}

/* EXAM mode wallpaper - bold purple coquette WITH motifs */
body.exam-mode:not(.night)::before{
  background:
    radial-gradient(ellipse 55% 35% at 8% 8%,#e8d8f8bb 0%,transparent 55%),
    radial-gradient(ellipse 45% 45% at 92% 92%,#d6b8f599 0%,transparent 55%),
    radial-gradient(ellipse 30% 30% at 50% 50%,#f0e8ff88 0%,transparent 70%),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Ctext x='10' y='38' font-size='22' opacity='0.13' transform='rotate(-18,10,38)'%3E%F0%9F%93%9A%3C/text%3E%3Ctext x='85' y='22' font-size='14' opacity='0.11' transform='rotate(10,85,22)'%3E%E2%AD%90%3C/text%3E%3Ctext x='152' y='50' font-size='17' opacity='0.10' transform='rotate(20,152,50)'%3E%F0%9F%AA%84%3C/text%3E%3Ctext x='38' y='88' font-size='15' opacity='0.11' transform='rotate(-12,38,88)'%3E%F0%9F%93%9D%3C/text%3E%3Ctext x='120' y='92' font-size='12' opacity='0.09' transform='rotate(8,120,92)'%3E%E2%AD%90%3C/text%3E%3Ctext x='178' y='105' font-size='19' opacity='0.12' transform='rotate(-25,178,105)'%3E%F0%9F%AA%84%3C/text%3E%3Ctext x='18' y='140' font-size='14' opacity='0.10' transform='rotate(15,18,140)'%3E%F0%9F%8E%AF%3C/text%3E%3Ctext x='95' y='152' font-size='23' opacity='0.12' transform='rotate(-8,95,152)'%3E%F0%9F%93%9A%3C/text%3E%3Ctext x='162' y='155' font-size='12' opacity='0.09' transform='rotate(22,162,155)'%3E%E2%AD%90%3C/text%3E%3Ctext x='50' y='188' font-size='17' opacity='0.11' transform='rotate(-5,50,188)'%3E%F0%9F%AA%84%3C/text%3E%3Ctext x='132' y='195' font-size='15' opacity='0.10' transform='rotate(12,132,195)'%3E%F0%9F%8E%AF%3C/text%3E%3Ctext x='65' y='62' font-size='11' opacity='0.09' transform='rotate(5,65,62)'%3E%F0%9F%92%9C%3C/text%3E%3Ctext x='142' y='130' font-size='13' opacity='0.09' transform='rotate(-15,142,130)'%3E%F0%9F%8C%99%3C/text%3E%3C/svg%3E");
}

/* Night HW wallpaper - dark but WITH motifs */
body.night:not(.exam-mode)::before{
  background:
    radial-gradient(ellipse 60% 40% at 10% 10%,#2e152244 0%,transparent 60%),
    radial-gradient(ellipse 50% 50% at 90% 90%,#3d1a2833 0%,transparent 60%),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Ctext x='10' y='38' font-size='22' opacity='0.09' transform='rotate(-18,10,38)'%3E%F0%9F%8E%80%3C/text%3E%3Ctext x='85' y='22' font-size='14' opacity='0.07' transform='rotate(10,85,22)'%3E%F0%9F%8C%B8%3C/text%3E%3Ctext x='152' y='50' font-size='17' opacity='0.07' transform='rotate(20,152,50)'%3E%F0%9F%AA%9E%3C/text%3E%3Ctext x='38' y='88' font-size='15' opacity='0.08' transform='rotate(-12,38,88)'%3E%F0%9F%8E%80%3C/text%3E%3Ctext x='120' y='92' font-size='12' opacity='0.06' transform='rotate(8,120,92)'%3E%F0%9F%8C%B7%3C/text%3E%3Ctext x='178' y='105' font-size='19' opacity='0.08' transform='rotate(-25,178,105)'%3E%F0%9F%AA%9E%3C/text%3E%3Ctext x='18' y='140' font-size='14' opacity='0.07' transform='rotate(15,18,140)'%3E%F0%9F%8C%B8%3C/text%3E%3Ctext x='95' y='152' font-size='23' opacity='0.09' transform='rotate(-8,95,152)'%3E%F0%9F%8E%80%3C/text%3E%3Ctext x='162' y='155' font-size='12' opacity='0.06' transform='rotate(22,162,155)'%3E%F0%9F%8C%B9%3C/text%3E%3Ctext x='50' y='188' font-size='17' opacity='0.08' transform='rotate(-5,50,188)'%3E%F0%9F%AA%9E%3C/text%3E%3Ctext x='132' y='195' font-size='15' opacity='0.07' transform='rotate(12,132,195)'%3E%F0%9F%8C%B8%3C/text%3E%3C/svg%3E");
}

/* Night EXAM wallpaper - dark purple WITH motifs */
body.exam-mode.night::before{
  background:
    radial-gradient(ellipse 60% 40% at 10% 10%,#2a155044 0%,transparent 60%),
    radial-gradient(ellipse 50% 50% at 90% 90%,#3e256033 0%,transparent 60%),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Ctext x='10' y='38' font-size='22' opacity='0.09' transform='rotate(-18,10,38)'%3E%F0%9F%93%9A%3C/text%3E%3Ctext x='85' y='22' font-size='14' opacity='0.07' transform='rotate(10,85,22)'%3E%E2%AD%90%3C/text%3E%3Ctext x='152' y='50' font-size='17' opacity='0.07' transform='rotate(20,152,50)'%3E%F0%9F%AA%84%3C/text%3E%3Ctext x='38' y='88' font-size='15' opacity='0.08' transform='rotate(-12,38,88)'%3E%F0%9F%93%9D%3C/text%3E%3Ctext x='120' y='92' font-size='12' opacity='0.06' transform='rotate(8,120,92)'%3E%E2%AD%90%3C/text%3E%3Ctext x='178' y='105' font-size='19' opacity='0.08' transform='rotate(-25,178,105)'%3E%F0%9F%AA%84%3C/text%3E%3Ctext x='18' y='140' font-size='14' opacity='0.07' transform='rotate(15,18,140)'%3E%F0%9F%8E%AF%3C/text%3E%3Ctext x='95' y='152' font-size='23' opacity='0.09' transform='rotate(-8,95,152)'%3E%F0%9F%93%9A%3C/text%3E%3Ctext x='162' y='155' font-size='12' opacity='0.06' transform='rotate(22,162,155)'%3E%E2%AD%90%3C/text%3E%3Ctext x='50' y='188' font-size='17' opacity='0.08' transform='rotate(-5,50,188)'%3E%F0%9F%AA%84%3C/text%3E%3Ctext x='132' y='195' font-size='15' opacity='0.07' transform='rotate(12,132,195)'%3E%F0%9F%8E%AF%3C/text%3E%3C/svg%3E");
}

.ribbon{position:fixed;font-size:1.4rem;opacity:.18;pointer-events:none;animation:float 6s ease-in-out infinite;}
.ribbon:nth-child(1){top:5%;left:3%;animation-delay:0s}
.ribbon:nth-child(2){top:15%;right:5%;animation-delay:1.5s}
.ribbon:nth-child(3){bottom:20%;left:2%;animation-delay:3s}
.ribbon:nth-child(4){bottom:10%;right:3%;animation-delay:4.5s}
@keyframes float{0%,100%{transform:translateY(0) rotate(-5deg)}50%{transform:translateY(-12px) rotate(5deg)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODE SELECTOR â€” CLEAN COQUETTE
   Warm cream background, wavy ribbon SVG
   borders, bow accent, gingham vs hearts motif
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes msFadeIn{from{opacity:0}to{opacity:1}}
@keyframes msLogoIn{from{opacity:0;transform:translateY(-22px) scale(.88)}to{opacity:1;transform:none}}
@keyframes msFadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
@keyframes bowSway{0%,100%{transform:translateX(-50%) rotate(-5deg) scale(1)}50%{transform:translateX(-50%) rotate(5deg) scale(1.06)}}
@keyframes bowSwayR{0%,100%{transform:translateX(-50%) rotate(4deg) scale(1)}50%{transform:translateX(-50%) rotate(-4deg) scale(1.06)}}
@keyframes floatDot{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}

#mode-selector{
  position:fixed;inset:0;z-index:800;
  display:flex;align-items:center;justify-content:center;
  animation:msFadeIn .5s ease;
  overflow:hidden;
}
#mode-selector.hidden{display:none;}

/* Warm cream coquette wallpaper â€” same motif style as rest of app */
#mode-selector::before{
  content:'';position:absolute;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 55% 40% at 8% 10%,#fde8f0cc 0%,transparent 55%),
    radial-gradient(ellipse 45% 45% at 92% 88%,#f9d0df99 0%,transparent 55%),
    radial-gradient(ellipse 30% 30% at 82% 12%,#ffd6e8bb 0%,transparent 50%),
    radial-gradient(ellipse 28% 28% at 12% 88%,#fde4ec88 0%,transparent 50%),
    linear-gradient(160deg,#fff8f5 0%,#fff2f5 40%,#fef5f8 70%,#fff8f5 100%),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Ctext x='10' y='38' font-size='22' opacity='0.10' transform='rotate(-18,10,38)'%3E%F0%9F%8E%80%3C/text%3E%3Ctext x='85' y='22' font-size='14' opacity='0.08' transform='rotate(10,85,22)'%3E%F0%9F%8C%B8%3C/text%3E%3Ctext x='152' y='50' font-size='17' opacity='0.08' transform='rotate(20,152,50)'%3E%F0%9F%AA%9E%3C/text%3E%3Ctext x='38' y='88' font-size='15' opacity='0.09' transform='rotate(-12,38,88)'%3E%F0%9F%8C%B7%3C/text%3E%3Ctext x='120' y='92' font-size='12' opacity='0.07' transform='rotate(8,120,92)'%3E%F0%9F%92%95%3C/text%3E%3Ctext x='178' y='105' font-size='19' opacity='0.09' transform='rotate(-25,178,105)'%3E%F0%9F%AA%9E%3C/text%3E%3Ctext x='18' y='140' font-size='14' opacity='0.08' transform='rotate(15,18,140)'%3E%F0%9F%8C%B8%3C/text%3E%3Ctext x='95' y='152' font-size='23' opacity='0.09' transform='rotate(-8,95,152)'%3E%F0%9F%8E%80%3C/text%3E%3Ctext x='162' y='155' font-size='12' opacity='0.07' transform='rotate(22,162,155)'%3E%F0%9F%8C%B9%3C/text%3E%3Ctext x='50' y='188' font-size='17' opacity='0.08' transform='rotate(-5,50,188)'%3E%F0%9F%AA%9E%3C/text%3E%3Ctext x='132' y='195' font-size='15' opacity='0.08' transform='rotate(12,132,195)'%3E%F0%9F%8C%B8%3C/text%3E%3C/svg%3E");
}

#mode-selector::after{content:none;}

.ms-inner{
  display:flex;flex-direction:column;align-items:center;gap:1.8rem;
  position:relative;z-index:2;
}

/* Logo */
.ms-logo{
  font-family:'Playfair Display',serif;font-style:italic;font-size:3rem;
  background:linear-gradient(135deg,#c8485e 0%,#e8789a 45%,#b83055 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 2px 12px rgba(200,72,94,.25));
  animation:msLogoIn .7s cubic-bezier(.34,1.56,.64,1) .1s both;
}
.ms-logo-bow{
  display:inline-block;-webkit-text-fill-color:initial;filter:none;
  font-style:normal;font-size:2.2rem;vertical-align:middle;margin-left:.1em;
  animation:floatDot 3s ease-in-out infinite;
}
.ms-sub{
  font-size:.72rem;letter-spacing:.25em;text-transform:uppercase;
  color:#c07080;font-weight:700;margin-top:-.8rem;
  animation:msFadeUp .55s ease .3s both;
}

/* Cards row */
.ms-cards{display:flex;gap:2.5rem;animation:msFadeUp .6s ease .45s both;align-items:flex-start;}

/* â”€â”€ BASE card: clean cream, ribbon SVG border, bow on top â”€â”€ */
.ms-card{
  position:relative;cursor:pointer;
  /* Card background itself â€” padding inner */
  display:flex;flex-direction:column;align-items:center;
  gap:.75rem;padding:2.2rem 2rem 1.8rem;
  /* No border-radius â€” the SVG frame handles the shape */
  background:transparent;
  transition:transform .3s cubic-bezier(.34,1.56,.64,1),filter .3s;
  min-width:195px;
}
.ms-card:hover{transform:translateY(-10px) scale(1.03);filter:drop-shadow(0 14px 28px rgba(180,60,80,.22));}

/* SVG ribbon frame â€” absolutely positioned, fills card */
.ms-card-frame{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;z-index:0;overflow:visible;}

/* Bow on top center */
.ms-card-bow{
  position:absolute;top:-26px;left:50%;
  pointer-events:none;z-index:3;
  animation:bowSway 4s ease-in-out infinite;
}
.ms-card.exam-card .ms-card-bow{animation:bowSwayR 4.3s ease-in-out infinite .5s;}

/* Card content z-index above frame */
.ms-card-icon,.ms-card-title,.ms-card-tagline,.ms-card-desc{position:relative;z-index:2;}

/* Inner card bg â€” placed above frame */
.ms-card-bg{
  position:absolute;inset:10px;border-radius:10px;z-index:1;pointer-events:none;
}
/* HW: gingham pattern */
.ms-card.hw-card .ms-card-bg{
  background:
    repeating-linear-gradient(0deg,transparent,transparent 10px,rgba(200,72,94,.06) 10px,rgba(200,72,94,.06) 11px),
    repeating-linear-gradient(90deg,transparent,transparent 10px,rgba(200,72,94,.06) 10px,rgba(200,72,94,.06) 11px),
    #fffaf9;
}
/* Exam: small hearts scattered */
.ms-card.exam-card .ms-card-bg{
  background:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30'%3E%3Ctext x='7' y='20' font-size='12' opacity='0.12'%3E%E2%9D%A4%3C/text%3E%3C/svg%3E"),
    #fffaf9;
}

.ms-card-icon{font-size:2.5rem;filter:drop-shadow(0 2px 6px rgba(180,60,80,.2));}
.ms-card-title{
  font-family:'Playfair Display',serif;font-size:1.12rem;font-weight:700;
  color:#8a2840;letter-spacing:.02em;
}
.ms-card-tagline{
  font-size:.6rem;letter-spacing:.18em;text-transform:uppercase;
  color:#c07888;font-weight:700;margin-top:-.2rem;
}
.ms-card-desc{font-size:.7rem;color:#b08090;text-align:center;line-height:1.65;max-width:135px;font-weight:500;}

/* Falling petals */
.ms-petal{
  position:absolute;z-index:1;pointer-events:none;
  animation:msPetal linear infinite;
}
@keyframes msPetal{
  0%{transform:translateY(-10px) rotate(0deg);opacity:0;}
  8%{opacity:.28;}92%{opacity:.15;}
  100%{transform:translateY(102vh) translateX(40px) rotate(480deg);opacity:0;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header{position:relative;z-index:10;display:flex;align-items:center;padding:.85rem 1.2rem;border-bottom:1.5px solid var(--bdr);background:var(--hbg);backdrop-filter:blur(8px);gap:.8rem;transition:background .35s,border-color .35s;}
.header-center{flex:1;text-align:center;}
.logo{font-family:'Playfair Display',serif;font-style:italic;font-size:2.1rem;color:var(--pk);text-shadow:0 2px 16px rgba(244,160,188,.4);}
.logo span{color:var(--tm);font-style:normal;font-size:1.3rem;vertical-align:middle;}
.tagline{font-size:.78rem;color:var(--tm);letter-spacing:.15em;text-transform:uppercase;margin-top:.15rem;font-weight:700;}
.mode-badge{display:inline-flex;align-items:center;gap:.35rem;padding:.18rem .7rem;border-radius:99px;font-size:.65rem;font-weight:800;letter-spacing:.12em;text-transform:uppercase;cursor:pointer;transition:all .2s;margin-top:.2rem;}
.mode-badge.hw{background:#fde8f0;color:#e8789a;border:1.5px solid #f9d0df;}
.mode-badge.exam{background:#e8d8f8;color:#9b6fd4;border:1.5px solid #d6b8f5;}
.mode-badge:hover{transform:scale(1.06);}
.icon-btn{background:none;border:1.5px solid var(--bdr);border-radius:10px;cursor:pointer;padding:.38rem .52rem;font-size:1rem;color:var(--tl);transition:all .2s;flex-shrink:0;line-height:1;display:flex;align-items:center;justify-content:center;}
.icon-btn:hover{background:var(--pkd);border-color:var(--pkm);color:var(--pk);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app{position:relative;z-index:1;display:flex;flex:1;height:calc(100vh - 68px);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar{width:270px;min-width:270px;background:var(--bgs);border-right:1.5px solid var(--bdr);display:flex;flex-direction:column;padding:1rem .7rem;gap:.2rem;overflow-y:auto;transition:width .25s,min-width .25s,padding .25s,opacity .2s,background .35s,border-color .35s;}
.sidebar.collapsed{width:0;min-width:0;padding:0;opacity:0;overflow:hidden;border-right:none;}
.sb-label{font-size:.63rem;letter-spacing:.2em;text-transform:uppercase;color:var(--tl);font-weight:700;padding:.5rem .6rem .3rem;white-space:nowrap;}

/* pinned strip */
.pinned-strip{margin-bottom:.35rem;}
.pinned-strip-label{font-size:.6rem;letter-spacing:.18em;text-transform:uppercase;color:#f4c23a;font-weight:700;padding:.3rem .6rem .2rem;}
.pinned-item{display:flex;align-items:center;gap:.4rem;padding:.35rem .65rem;border-radius:9px;border:1.5px solid #f4c23a44;background:#fffbee;cursor:pointer;font-size:.78rem;font-weight:700;color:#b8870a;width:100%;text-align:left;transition:.15s;position:relative;}
.pinned-item:hover{background:#fff8dc;border-color:#f4c23a;}
.pinned-item-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.pinned-item-sub{font-size:.6rem;color:#d4a030;font-weight:500;white-space:nowrap;}
body.night .pinned-item{background:rgba(60,50,10,.5);color:#f4c23a;}

.matkul-row{width:100%;}
.matkul-hdr{display:flex;align-items:center;gap:.4rem;padding:.55rem .6rem;border-radius:10px;border:1.5px solid transparent;background:transparent;cursor:pointer;width:100%;text-align:left;transition:all .18s;}
.matkul-hdr:hover{background:var(--pkd);border-color:var(--bdr);}
.matkul-hdr.open{background:var(--pkd);border-color:var(--bdr);}
.matkul-chev{font-size:.6rem;color:var(--tl);transition:transform .2s;flex-shrink:0;}
.matkul-hdr.open .matkul-chev{transform:rotate(90deg);}
.matkul-icon{font-size:1rem;flex-shrink:0;}
.matkul-name{flex:1;font-size:.9rem;font-weight:700;color:var(--td);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0;}
.matkul-cnt{font-size:.6rem;font-weight:700;background:var(--pkd);color:var(--pk);padding:.06rem .35rem;border-radius:99px;flex-shrink:0;}
.matkul-acts{display:none;gap:2px;}
.matkul-hdr:hover .matkul-acts{display:flex;}
.matkul-act{background:none;border:none;cursor:pointer;padding:2px 5px;border-radius:6px;font-size:.72rem;color:var(--tl);transition:.15s;}
.matkul-act:hover{background:var(--pkd);color:var(--pk);}
.gdrive-btn{background:none;border:none;cursor:pointer;font-size:.85rem;padding:1px 4px;border-radius:6px;transition:.15s;flex-shrink:0;opacity:.4;line-height:1;}
.gdrive-btn:hover{background:var(--pkd);opacity:1;}
.gdrive-btn.has-link{opacity:1;}

.subfolder-list{padding-left:1.4rem;display:flex;flex-direction:column;gap:.15rem;margin:.15rem 0 .2rem;animation:fadeIn .2s ease;}
.sfbtn{display:flex;align-items:center;gap:.4rem;padding:.45rem .65rem;border-radius:9px;border:1.5px solid transparent;background:transparent;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.8rem;font-weight:600;color:var(--tm);text-align:left;transition:all .15s;width:100%;position:relative;}
.sfbtn:hover{background:var(--pkd);border-color:var(--bdr);color:var(--pk);}
.sfbtn.active{background:linear-gradient(135deg,var(--pkp),var(--pkd));border-color:var(--pkm);color:var(--pk);font-weight:700;box-shadow:0 2px 8px var(--shd);}
.sfbtn.pinned-f{border-left:3px solid #f4c23a!important;}

body.exam-mode .sfbtn:hover{background:var(--exd);border-color:var(--exb);color:var(--ex);}
body.exam-mode .sfbtn.active{background:linear-gradient(135deg,var(--exp),var(--exd));border-color:var(--exm);color:var(--ex);box-shadow:0 2px 8px var(--exs);}

.sf-icon{font-size:.82rem;flex-shrink:0;}
.sf-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0;max-width:100px;}
.sf-tooltip{display:none;position:absolute;left:calc(100% + 8px);top:50%;transform:translateY(-50%);background:rgba(40,15,28,.95);color:#f0c0d5;padding:.32rem .75rem;border-radius:9px;font-size:.73rem;white-space:nowrap;z-index:999;pointer-events:none;box-shadow:0 4px 16px rgba(0,0,0,.28);border:1px solid #5a2d3e;}
body.exam-mode .sf-tooltip{background:rgba(20,10,40,.95);color:#d4b8f5;border-color:#4a3570;}
.sfbtn:hover .sf-tooltip{display:block;}
.sf-del{background:none;border:none;cursor:pointer;color:var(--tl);font-size:.68rem;padding:2px 5px;border-radius:5px;display:none;transition:.15s;flex-shrink:0;}
.sfbtn:hover .sf-del{display:block;}
.sf-del:hover{background:var(--pkd);color:var(--pk);}

.sb-status-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.sb-status-dot.untouched{background:#e05555;}
.sb-status-dot.on-progress{background:#f4c23a;}
.sb-status-dot.done{background:#5a9fe0;}
.sb-status-dot.submitted{background:#5ec47e;}

.exam-type-mini{font-size:.56rem;font-weight:800;padding:.04rem .3rem;border-radius:99px;flex-shrink:0;}
.exam-type-mini.quiz{background:#fff3cd;color:#856404;}
.exam-type-mini.uts{background:#cff4fc;color:#0c5460;}
.exam-type-mini.uas{background:#d1e7dd;color:#0f5132;}

.add-sf-btn{display:flex;align-items:center;gap:.4rem;padding:.35rem .65rem;border-radius:9px;border:1.5px dashed var(--pkm);background:transparent;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.76rem;font-weight:600;color:var(--tl);transition:all .15s;width:100%;}
.add-sf-btn:hover{background:var(--pkd);color:var(--pk);border-color:var(--pk);}
body.exam-mode .add-sf-btn{border-color:var(--exm);}
body.exam-mode .add-sf-btn:hover{background:var(--exd);color:var(--ex);border-color:var(--ex);}

.add-matkul-btn{display:flex;align-items:center;gap:.5rem;padding:.6rem .75rem;border-radius:12px;border:1.5px dashed var(--pkm);background:transparent;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.83rem;font-weight:600;color:var(--tl);transition:all .2s;margin-top:.5rem;width:100%;}
.add-matkul-btn:hover{background:var(--pkd);color:var(--pk);border-color:var(--pk);}
.cal-sidebar-btn{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;border-radius:12px;border:1.5px solid var(--exb);background:transparent;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.8rem;font-weight:700;color:var(--ex);transition:all .2s;margin-top:.3rem;width:100%;}
.cal-sidebar-btn:hover{background:var(--exd);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COQUETTE DATE & TIME PICKER STYLING
   Native pickers are styled where CSS allows,
   plus a custom overlay for a coquette look
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* Style the date/time inputs themselves */
input[type="date"],input[type="time"]{
  color-scheme:light;
  font-family:'DM Sans',sans-serif;
}
/* Custom date picker overlay wrapper */
.date-picker-wrap{position:relative;display:inline-flex;align-items:center;}
.date-picker-wrap input[type="date"]{
  opacity:1;
  cursor:pointer;
}
/* Coquette picker popup - override browser default where possible */
input[type="date"]::-webkit-calendar-picker-indicator,
input[type="time"]::-webkit-calendar-picker-indicator{
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f4a0bc' stroke-width='2'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'/%3E%3Cline x1='16' y1='2' x2='16' y2='6'/%3E%3Cline x1='8' y1='2' x2='8' y2='6'/%3E%3Cline x1='3' y1='10' x2='21' y2='10'/%3E%3C/svg%3E") center/contain no-repeat;
  cursor:pointer;opacity:1;padding:2px;border-radius:4px;
  transition:transform .15s;
}
input[type="date"]::-webkit-calendar-picker-indicator:hover,
input[type="time"]::-webkit-calendar-picker-indicator:hover{
  transform:scale(1.2);
  background-color:rgba(244,160,188,.15);border-radius:4px;
}
/* Exam mode date picker icon purple */
body.exam-mode input[type="date"]::-webkit-calendar-picker-indicator,
body.exam-mode input[type="time"]::-webkit-calendar-picker-indicator,
.exam-inp::-webkit-calendar-picker-indicator{
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23b899e0' stroke-width='2'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'/%3E%3Cline x1='16' y1='2' x2='16' y2='6'/%3E%3Cline x1='8' y1='2' x2='8' y2='6'/%3E%3Cline x1='3' y1='10' x2='21' y2='10'/%3E%3C/svg%3E") center/contain no-repeat !important;
  filter:none !important;
}
/* Countdown box exam inputs keep white icon */
.countdown-box input[type="date"]::-webkit-calendar-picker-indicator,
.countdown-box input[type="time"]::-webkit-calendar-picker-indicator{
  filter:invert(1) !important;opacity:.7;
}
/* Style the popup calendar widget (Chromium) */
::-webkit-datetime-edit-fields-wrapper{padding:0;}
::-webkit-datetime-edit{font-family:'DM Sans',sans-serif;}
/* Custom Coquette Date Picker Modal */
#cq-picker-overlay{position:fixed;inset:0;z-index:600;display:flex;align-items:center;justify-content:center;background:rgba(90,30,55,.2);backdrop-filter:blur(6px);animation:fadeIn .15s ease;}
#cq-picker-overlay.hidden{display:none;}
.cq-picker{background:linear-gradient(145deg,#fff5f9,#fde8f0);border:2px solid #f9d0df;border-radius:24px;padding:1.5rem;width:340px;box-shadow:0 20px 60px rgba(232,120,154,.28);animation:popIn .2s ease;position:relative;}
body.exam-mode .cq-picker{background:linear-gradient(145deg,#f5f0ff,#ecdcf8);border-color:#d6b8f5;box-shadow:0 20px 60px rgba(155,111,212,.28);}
body.night .cq-picker{background:linear-gradient(145deg,#2a1520,#1e0f18);border-color:#5a2d3e;}
body.exam-mode.night .cq-picker{background:linear-gradient(145deg,#1e1230,#120a1e);border-color:#3e2560;}
.cq-picker-title{font-family:'Playfair Display',serif;font-style:italic;font-size:1.1rem;color:var(--pk);margin-bottom:1rem;text-align:center;}
.cq-cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:.85rem;}
.cq-cal-nav-btn{background:none;border:1.5px solid var(--bdr);border-radius:8px;cursor:pointer;padding:.22rem .6rem;font-size:.8rem;color:var(--pk);font-weight:700;transition:.15s;}
.cq-cal-nav-btn:hover{background:var(--pkd);}
.cq-month-lbl{font-family:'Playfair Display',serif;font-size:.95rem;font-weight:700;color:var(--td);text-align:center;}
.cq-cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:.75rem;}
.cq-dow{text-align:center;font-size:.6rem;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:var(--tl);padding:.2rem 0;}
.cq-day{aspect-ratio:1;border-radius:50%;border:none;background:transparent;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:600;color:var(--td);transition:all .15s;display:flex;align-items:center;justify-content:center;}
.cq-day:hover{background:var(--pkd);color:var(--pk);}
.cq-day.today{border:1.5px solid var(--pkm);color:var(--pk);font-weight:800;}
.cq-day.selected{background:linear-gradient(135deg,var(--pkm),var(--pk));color:white;font-weight:800;box-shadow:0 2px 8px var(--shd);}
.cq-day.other-m{opacity:.3;cursor:default;}
.cq-day.other-m:hover{background:transparent;color:var(--td);}
body.exam-mode .cq-day:hover{background:var(--exd);color:var(--ex);}
body.exam-mode .cq-day.today{border-color:var(--exm);color:var(--ex);}
body.exam-mode .cq-day.selected{background:linear-gradient(135deg,var(--exm),var(--ex));box-shadow:0 2px 8px var(--exs);}
.cq-time-row{display:flex;align-items:center;justify-content:center;gap:.6rem;margin-bottom:.85rem;padding:.6rem;background:var(--pkd);border-radius:12px;}
body.exam-mode .cq-time-row{background:var(--exd);}
.cq-time-lbl{font-size:.65rem;letter-spacing:.12em;text-transform:uppercase;font-weight:800;color:var(--tl);}
.cq-time-inp{width:70px;text-align:center;border:1.5px solid var(--bdr);border-radius:9px;padding:.32rem .5rem;font-family:'DM Sans',sans-serif;font-size:.9rem;font-weight:700;color:var(--td);background:white;outline:none;transition:border-color .2s;}
.cq-time-inp:focus{border-color:var(--pkm);}
body.night .cq-time-inp{background:rgba(58,25,40,.9);border-color:var(--bdr);color:var(--td);}
.cq-colon{font-size:1.2rem;font-weight:800;color:var(--pk);}
.cq-btns{display:flex;gap:.5rem;justify-content:flex-end;}
.cq-btn-cancel{padding:.38rem .9rem;border-radius:9px;border:1.5px solid var(--bdr);background:white;color:var(--tl);cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:600;transition:.15s;}
.cq-btn-cancel:hover{background:var(--pkd);color:var(--tm);}
.cq-btn-ok{padding:.38rem 1.1rem;border-radius:9px;border:none;background:linear-gradient(135deg,var(--pkm),var(--pk));color:white;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:700;transition:.15s;box-shadow:0 2px 8px var(--shd);}
.cq-btn-ok:hover{transform:translateY(-1px);box-shadow:0 4px 12px var(--shd);}
body.exam-mode .cq-btn-ok{background:linear-gradient(135deg,var(--exm),var(--ex));box-shadow:0 2px 8px var(--exs);}
body.night .cq-btn-cancel{background:rgba(58,25,40,.7);border-color:var(--bdr);color:var(--td);}
/* trigger button for date - shows a cute pill instead of default */
.date-trigger-btn{display:inline-flex;align-items:center;gap:.35rem;padding:.22rem .75rem;border-radius:99px;border:1.5px solid var(--bdr);background:white;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.76rem;font-weight:600;color:var(--td);transition:all .2s;white-space:nowrap;}
.date-trigger-btn:hover{border-color:var(--pkm);background:var(--pkd);color:var(--pk);}
.date-trigger-btn .cal-icon{font-size:.85rem;}
body.exam-mode .date-trigger-btn:hover{border-color:var(--exm);background:var(--exd);color:var(--ex);}
body.night .date-trigger-btn{background:rgba(58,25,40,.9);border-color:var(--bdr);color:var(--td);}

.ctx-menu{position:fixed;z-index:700;background:white;border:1.5px solid var(--bdr);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.15);padding:.4rem 0;min-width:155px;animation:popIn .15s ease;}
.ctx-item{display:flex;align-items:center;gap:.5rem;padding:.48rem .9rem;font-size:.8rem;font-weight:600;color:var(--td);cursor:pointer;transition:.1s;}
.ctx-item:hover{background:var(--pkd);color:var(--pk);}
.ctx-item.danger:hover{background:#fdeaea;color:#c03030;}
.ctx-sep{height:1px;background:var(--bdr);margin:.25rem 0;}
body.night .ctx-menu{background:#2a1520;border-color:var(--bdr);}
body.night .ctx-item:hover{background:#3d1e2a;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.content{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem;color:var(--tl);animation:fadeIn .4s ease;}
.empty-icon{font-size:3.5rem;opacity:.5;}
.empty-text{font-size:1rem;font-weight:600;}
.memo-page,.exam-page{flex:1;display:flex;flex-direction:column;padding:1.8rem 2.5rem;overflow-y:auto;animation:fadeIn .3s ease;}

@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
@keyframes slideIn{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:none}}
@keyframes popIn{from{opacity:0;transform:scale(.88) translateY(12px)}to{opacity:1;transform:none}}

/* â”€â”€ HW memo components â”€â”€ */
.crumb{display:flex;align-items:center;gap:.4rem;font-size:.73rem;font-weight:700;color:var(--tl);margin-bottom:.7rem;letter-spacing:.05em;}
.crumb .cs{color:var(--tm);}
.crumb .sep{color:var(--pkm);font-size:.9rem;}
.crumb .ct{color:var(--pk);}

.memo-hdr{display:flex;align-items:flex-start;gap:1rem;margin-bottom:1.4rem;padding-bottom:1rem;border-bottom:1.5px solid var(--bdr);}
.memo-icon{font-size:1.7rem;padding-top:4px;flex-shrink:0;}
.memo-fields{display:flex;flex-direction:column;flex:1;gap:.5rem;min-width:0;}
.memo-title{font-family:'Playfair Display',serif;font-size:1.65rem;font-style:italic;color:var(--td);background:transparent;border:none;outline:none;border-bottom:2px solid transparent;transition:border-color .2s;width:100%;}
.memo-title:focus{border-bottom-color:var(--pkm);}

.status-strip{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;}
.sl{font-size:.66rem;letter-spacing:.14em;text-transform:uppercase;font-weight:800;color:var(--tl);white-space:nowrap;}
.sbtn{display:flex;align-items:center;gap:.32rem;padding:.28rem .8rem;border-radius:99px;border:1.5px solid var(--bdr);background:white;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.73rem;font-weight:700;color:var(--tl);transition:all .18s;}
.sbtn .sdot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.sbtn.a-untouched{background:#fdeaea;border-color:#e05555;color:#c03030;}
.sbtn.a-on-progress{background:#fff8ee;border-color:#f4c23a;color:#b8870a;}
.sbtn.a-done{background:#eaf2fd;border-color:#5a9fe0;color:#2a6fb5;}
.sbtn.a-submitted{background:#edfaf3;border-color:#5ec47e;color:#228a4a;}

.date-row{display:flex;align-items:center;gap:.6rem;flex-wrap:wrap;}
.df{display:flex;align-items:center;gap:.5rem;}
.dfl{font-size:.66rem;letter-spacing:.13em;text-transform:uppercase;font-weight:800;color:var(--tl);white-space:nowrap;}
.dfl.dead{color:#d63d3d;font-weight:900;}
.start-pill{display:flex;align-items:center;gap:.32rem;background:white;border:1.5px solid var(--bdr);border-radius:99px;padding:.2rem .28rem .2rem .68rem;transition:border-color .2s;}
.start-pill:focus-within{border-color:var(--pkm);}
.date-inp{border:none;outline:none;background:transparent;font-family:'DM Sans',sans-serif;font-size:.76rem;font-weight:600;color:var(--td);cursor:pointer;width:120px;}
.today-btn{padding:.16rem .6rem;border-radius:99px;border:1.5px solid var(--pkm);background:var(--pkd);cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.7rem;font-weight:700;color:var(--pk);transition:all .15s;white-space:nowrap;}
.today-btn:hover{background:var(--pkm);color:white;}
.deadline-pill{display:flex;align-items:center;gap:.32rem;background:white;border:1.5px solid #f5b8b8;border-radius:99px;padding:.2rem .5rem .2rem .68rem;transition:border-color .2s;}
.deadline-pill.overdue{background:#fff5f5;border-color:#e74c3c;}
.dl-inp{border:none;outline:none;background:transparent;font-family:'DM Sans',sans-serif;font-size:.76rem;font-weight:700;color:#c0392b;cursor:pointer;}
.dl-inp.date{width:118px;}
.dl-inp.time{width:70px;}
.dl-clear{background:none;border:none;cursor:pointer;color:#e8a0a0;font-size:.68rem;padding:0 2px;line-height:1;transition:.15s;}
.dl-clear:hover{color:#e74c3c;}

.card{background:var(--bgc);border:1.5px solid var(--bdr);border-radius:16px;padding:.85rem 1.1rem;margin-bottom:1.3rem;backdrop-filter:blur(4px);}
.card-label{font-size:.66rem;letter-spacing:.18em;text-transform:uppercase;color:var(--tl);font-weight:700;}
.card-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:.7rem;}

.submit-toggle{display:flex;align-items:center;gap:.42rem;padding:.32rem .95rem;border-radius:99px;border:1.5px solid var(--bdr);background:white;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.76rem;font-weight:700;color:var(--tl);transition:all .2s;}
.submit-toggle:hover,.submit-toggle.on{border-color:#7ab4e8;color:#2965ad;background:#edf4fd;}
.submit-toggle.on{background:linear-gradient(135deg,#d6ecfc,#edf4fd);box-shadow:0 2px 10px rgba(122,180,232,.25);}
.link-row{display:flex;align-items:center;gap:.5rem;}
.link-label{font-size:.66rem;letter-spacing:.14em;text-transform:uppercase;font-weight:700;color:var(--tl);white-space:nowrap;min-width:78px;}
.link-wrap{display:flex;align-items:center;gap:.4rem;flex:1;min-width:0;}
.link-inp{flex:1;padding:.3rem .72rem;border:1.5px solid var(--bdr);border-radius:99px;font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:500;color:var(--td);background:white;outline:none;min-width:0;transition:border-color .2s;}
.link-inp:focus{border-color:#7ab4e8;}
.open-btn{padding:.3rem .78rem;border-radius:99px;border:1.5px solid var(--bdr);background:white;cursor:pointer;font-size:.73rem;font-weight:600;color:var(--tm);transition:.15s;white-space:nowrap;flex-shrink:0;}
.open-btn:hover{border-color:#7ab4e8;color:#2965ad;background:#edf4fd;}

.two-col{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;}
.col-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:.32rem;}
.col-btns{display:flex;gap:.28rem;}
.add-chip-btn{display:flex;align-items:center;gap:.35rem;padding:.2rem .55rem;border-radius:99px;border:1.5px solid var(--pkm);background:white;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.7rem;font-weight:600;color:var(--pk);transition:all .2s;}
.add-chip-btn:hover{background:var(--pkd);border-color:var(--pk);}
.add-chip-btn.blue{border-color:#7ab4e8;color:#2965ad;}
.add-chip-btn.blue:hover{background:#edf4fd;}
.col-div{width:1px;background:var(--bdr);}
.chips-wrap{display:flex;flex-wrap:wrap;gap:.38rem;min-height:26px;}
.file-chip{display:flex;align-items:center;gap:.38rem;padding:.26rem .62rem;border-radius:99px;background:linear-gradient(135deg,var(--pkp),var(--pkd));border:1.5px solid var(--bdr);font-size:.76rem;font-weight:600;color:var(--tm);cursor:pointer;transition:all .2s;max-width:200px;}
.file-chip:hover{border-color:var(--pkm);box-shadow:0 2px 8px var(--shd);}
.chip-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:140px;}
.chip-del{background:none;border:none;cursor:pointer;color:var(--tl);font-size:.66rem;padding:0 2px;transition:.15s;flex-shrink:0;}
.chip-del:hover{color:var(--pk);}
.link-chip{display:flex;align-items:center;gap:.32rem;padding:.2rem .52rem;border-radius:99px;background:linear-gradient(135deg,#f0f8ff,#e8f4fd);border:1.5px solid #c5ddf8;font-size:.73rem;font-weight:600;color:#3d6dbd;cursor:default;transition:all .2s;max-width:200px;}
.link-chip:hover{border-color:#7ab4e8;box-shadow:0 2px 8px rgba(122,180,232,.25);}
.link-chip-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:125px;cursor:pointer;text-decoration:underline;text-underline-offset:2px;}
.link-chip-del{background:none;border:none;cursor:pointer;color:#8aaee0;font-size:.66rem;padding:0 2px;transition:.15s;flex-shrink:0;}
.link-chip-del:hover{color:#2965ad;}
.add-link-row{display:flex;align-items:center;gap:.28rem;margin-top:.2rem;}
.add-link-inp{flex:1;padding:.2rem .52rem;border:1.5px solid var(--bdr);border-radius:99px;font-family:'DM Sans',sans-serif;font-size:.73rem;font-weight:500;color:var(--td);background:white;outline:none;min-width:0;transition:border-color .2s;}
.add-link-inp:focus{border-color:#7ab4e8;}
.add-link-ok{padding:.2rem .55rem;border-radius:99px;border:1.5px solid #c5ddf8;background:#edf4fd;cursor:pointer;font-size:.7rem;font-weight:700;color:#2965ad;transition:.15s;white-space:nowrap;}
.add-link-ok:hover{background:#daeafa;}
.chip-empty{font-size:.76rem;color:var(--tl);font-weight:500;font-style:italic;}

.notes-ta{width:100%;min-height:88px;padding:.58rem .78rem;border:1.5px solid var(--bdr);border-radius:12px;font-family:'DM Sans',sans-serif;font-size:.83rem;font-weight:500;color:var(--td);background:linear-gradient(135deg,#fffaf9,#fff5f8);outline:none;resize:vertical;transition:border-color .2s;line-height:1.6;margin-top:.55rem;}
.notes-ta:focus{border-color:var(--pkm);}
.notes-ta::placeholder{color:var(--tl);font-style:italic;}

.task-lbl{font-size:.66rem;letter-spacing:.18em;text-transform:uppercase;color:var(--tl);font-weight:700;margin-bottom:.85rem;}
.task-list{display:flex;flex-direction:column;gap:.65rem;margin-bottom:.85rem;}
.task-card{background:var(--bgc);border:1.5px solid var(--bdr);border-radius:14px;overflow:hidden;transition:all .2s;animation:slideIn .22s ease;backdrop-filter:blur(4px);}
.task-card:hover{box-shadow:0 2px 14px var(--shd);border-color:var(--pkm);}
.task-main{display:flex;align-items:center;gap:.72rem;padding:.68rem .88rem;}
.task-chk{width:21px;height:21px;border-radius:50%;border:2px solid var(--pkm);background:transparent;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:.73rem;user-select:none;}
.task-chk.done{background:var(--pkm);border-color:var(--pkm);color:white;}
.task-num{font-family:'Playfair Display',serif;font-size:.93rem;color:var(--pk);font-weight:700;min-width:1.35rem;flex-shrink:0;}
.task-inp{flex:1;border:none;background:transparent;font-family:'DM Sans',sans-serif;font-size:.86rem;font-weight:600;color:var(--td);outline:none;min-width:0;}
.task-inp.done{text-decoration:line-through;color:var(--tl);}
.task-exp{background:none;border:none;cursor:pointer;color:var(--tl);font-size:.73rem;padding:3px 7px;border-radius:6px;transition:.15s;flex-shrink:0;font-weight:600;}
.task-exp:hover{background:var(--pkd);color:var(--pk);}
.task-del{background:none;border:none;cursor:pointer;color:var(--tl);font-size:.73rem;padding:3px 7px;border-radius:6px;opacity:0;transition:.15s;flex-shrink:0;}
.task-card:hover .task-del{opacity:1;}
.task-del:hover{background:var(--pkd);color:var(--pk);}
.task-attach{border-top:1.5px dashed var(--bdr);padding:.62rem .88rem .72rem;display:none;flex-direction:column;gap:.52rem;background:linear-gradient(135deg,var(--pkp),var(--pkd)44);animation:fadeIn .2s ease;}
.task-attach.open{display:flex;}
.attach-row{display:flex;align-items:center;gap:.48rem;flex-wrap:wrap;}
.attach-lbl{font-size:.63rem;letter-spacing:.13em;text-transform:uppercase;font-weight:700;color:var(--tl);min-width:53px;}
.link-inp-wrap{display:flex;align-items:center;gap:.38rem;flex:1;min-width:0;}
.ta-inp{flex:1;padding:.26rem .58rem;border:1.5px solid var(--bdr);border-radius:99px;font-family:'DM Sans',sans-serif;font-size:.76rem;font-weight:500;color:var(--td);background:white;outline:none;min-width:0;transition:border-color .2s;}
.ta-inp:focus{border-color:var(--pkm);}
.ta-open{padding:.26rem .62rem;border-radius:99px;border:1.5px solid var(--bdr);background:white;cursor:pointer;font-size:.73rem;font-weight:600;color:var(--tm);transition:.15s;white-space:nowrap;flex-shrink:0;}
.ta-open:hover{border-color:var(--pkm);color:var(--pk);background:var(--pkd);}
.photo-chips{display:flex;flex-wrap:wrap;gap:.38rem;align-items:center;}
.photo-chip{position:relative;width:48px;height:48px;border-radius:9px;overflow:hidden;border:2px solid var(--bdr);cursor:pointer;transition:all .2s;flex-shrink:0;}
.photo-chip:hover{border-color:var(--pkm);box-shadow:0 2px 8px var(--shd);}
.photo-chip img{width:100%;height:100%;object-fit:cover;display:block;}
.photo-chip-del{position:absolute;top:2px;right:2px;background:rgba(90,45,62,.75);color:white;border:none;border-radius:50%;width:14px;height:14px;font-size:.48rem;cursor:pointer;display:none;align-items:center;justify-content:center;line-height:1;}
.photo-chip:hover .photo-chip-del{display:flex;}
.photo-add{width:48px;height:48px;border-radius:9px;border:1.5px dashed var(--pkm);background:white;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.05rem;color:var(--pkm);transition:all .2s;flex-shrink:0;position:relative;}
.photo-add:hover{border-color:var(--pk);color:var(--pk);background:var(--pkd);}
.photo-add input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;}
.add-task-row{display:flex;align-items:center;gap:.72rem;padding:.62rem .88rem;background:linear-gradient(135deg,var(--pkp),var(--pkd)44);border:1.5px dashed var(--pkm);border-radius:12px;cursor:pointer;transition:all .2s;color:var(--tl);font-size:.83rem;font-weight:600;}
.add-task-row:hover{border-color:var(--pk);color:var(--pk);background:var(--pkd);}
.progress-section{margin-top:1.2rem;padding-top:.88rem;border-top:1px solid var(--bdr);}
.progress-row{display:flex;align-items:center;gap:1rem;margin-bottom:.38rem;}
.progress-text{font-size:.76rem;color:var(--tl);font-weight:600;}
.progress-pct{font-size:.76rem;color:var(--pk);font-weight:700;margin-left:auto;}
.progress-bar{height:6px;background:var(--pkd);border-radius:99px;overflow:hidden;}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--pkm),var(--pk));border-radius:99px;transition:width .4s ease;}

.folder-attach-btns{display:flex;gap:.38rem;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXAM PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.exam-crumb .cs{color:#6a4aad;}
.exam-crumb .ct{color:#9b6fd4;}
.exam-crumb .sep{color:#b899e0;}

.exam-hdr{display:flex;align-items:flex-start;gap:1.2rem;margin-bottom:1.4rem;padding-bottom:1rem;border-bottom:1.5px solid var(--exb);}
.exam-hdr-left{flex:1;min-width:0;}
.exam-title-row{display:flex;align-items:center;gap:.8rem;margin-bottom:.55rem;}
.exam-type-badge{padding:.18rem .78rem;border-radius:99px;font-size:.7rem;font-weight:800;letter-spacing:.1em;text-transform:uppercase;}
.exam-type-badge.quiz{background:#fff3cd;color:#856404;border:1.5px solid #ffc107;}
.exam-type-badge.uts{background:#cff4fc;color:#0c5460;border:1.5px solid #0dcaf0;}
.exam-type-badge.uas{background:#d1e7dd;color:#0f5132;border:1.5px solid #198754;}
.exam-title-inp{font-family:'Playfair Display',serif;font-size:1.45rem;font-style:italic;color:#2e1460;background:transparent;border:none;outline:none;border-bottom:2px solid transparent;transition:border-color .2s;flex:1;}
.exam-title-inp:focus{border-bottom-color:#b899e0;}
body.night .exam-title-inp{color:var(--td);}

/* countdown widget */
.countdown-box{background:linear-gradient(135deg,#4a2080,#7a40c0);border-radius:18px;padding:1.05rem 1.45rem;color:white;min-width:255px;flex-shrink:0;text-align:center;transition:all .3s;}
.countdown-box.no-date{background:linear-gradient(135deg,#7a6090,#9a80b0);opacity:.7;}
.cd-label{font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;color:#d0b8f8;font-weight:700;margin-bottom:.45rem;}
.cd-timer{display:flex;align-items:center;justify-content:center;gap:.45rem;}
.cd-unit{display:flex;flex-direction:column;align-items:center;gap:.12rem;}
.cd-num{font-family:'Playfair Display',serif;font-size:1.75rem;font-weight:700;line-height:1;min-width:2.4rem;text-align:center;}
.cd-unit-lbl{font-size:.56rem;text-transform:uppercase;letter-spacing:.1em;color:#d0b8f8;font-weight:700;}
.cd-sep{font-size:1.3rem;color:#d0b8f8;padding-bottom:.75rem;}
.exam-when-row{display:flex;align-items:center;gap:.55rem;margin-top:.55rem;flex-wrap:wrap;justify-content:center;}
.exam-when-lbl{font-size:.6rem;letter-spacing:.12em;text-transform:uppercase;color:#d0b8f8;font-weight:700;}
.exam-inp{background:rgba(255,255,255,.15);border:1.5px solid rgba(255,255,255,.28);border-radius:8px;padding:.18rem .48rem;font-family:'DM Sans',sans-serif;font-size:.73rem;font-weight:600;color:white;outline:none;cursor:pointer;transition:border-color .2s;}
.exam-inp:focus{border-color:rgba(255,255,255,.7);}
.exam-inp::-webkit-calendar-picker-indicator{filter:invert(1);opacity:.6;cursor:pointer;}
.exam-room-inp{background:rgba(255,255,255,.15);border:1.5px solid rgba(255,255,255,.28);border-radius:8px;padding:.18rem .48rem;font-family:'DM Sans',sans-serif;font-size:.73rem;font-weight:600;color:white;outline:none;width:95px;}
.exam-room-inp::placeholder{color:rgba(255,255,255,.38);}
.exam-room-inp:focus{border-color:rgba(255,255,255,.7);}

.exam-card{background:var(--bgc);border:1.5px solid var(--exb);border-radius:16px;padding:.85rem 1.1rem;margin-bottom:1.2rem;backdrop-filter:blur(4px);}
.exam-card-label{font-size:.66rem;letter-spacing:.18em;text-transform:uppercase;color:#9a7ac8;font-weight:700;}
.sources-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.7rem;margin-top:.8rem;}
.source-item{display:flex;flex-direction:column;gap:.32rem;}
.source-lbl{font-size:.63rem;letter-spacing:.12em;text-transform:uppercase;font-weight:800;color:#6a4aad;}
.source-field{display:flex;align-items:center;gap:.32rem;background:white;border:1.5px solid var(--exb);border-radius:10px;padding:.32rem .62rem;transition:border-color .2s;}
.source-field:focus-within{border-color:#b899e0;}
.source-url{flex:1;border:none;outline:none;background:transparent;font-family:'DM Sans',sans-serif;font-size:.76rem;font-weight:500;color:var(--td);}
.source-url::placeholder{color:var(--tl);font-style:italic;}
.source-open{background:none;border:none;cursor:pointer;color:#b899e0;font-size:.73rem;font-weight:700;transition:.15s;padding:0 2px;}
.source-open:hover{color:#9b6fd4;}
body.night .source-field{background:rgba(30,20,50,.8);border-color:#4a3570;}

.materi-list{display:flex;flex-direction:column;gap:.48rem;margin-bottom:.65rem;}
.materi-item{display:flex;flex-direction:column;border:1.5px solid var(--exb);border-radius:10px;overflow:hidden;animation:slideIn .2s ease;}
.materi-main{display:flex;align-items:center;gap:.58rem;padding:.45rem .68rem;background:linear-gradient(135deg,#f5f0ff,#f0eaff);transition:all .18s;}
.materi-main:hover{border-color:#b899e0;}
.materi-chk{width:18px;height:18px;border-radius:5px;border:2px solid #b899e0;background:transparent;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:.68rem;transition:all .2s;}
.materi-chk.done{background:#b899e0;border-color:#9b6fd4;color:white;}
.materi-name-inp{flex:1;border:none;background:transparent;font-family:'DM Sans',sans-serif;font-size:.83rem;font-weight:600;color:#2e1460;outline:none;}
.materi-name-inp.done{text-decoration:line-through;color:#9a7ac8;}
body.night .materi-name-inp{color:var(--td);}
body.night .materi-name-inp.done{color:var(--tl);}
.materi-btns{display:flex;gap:.22rem;align-items:center;}
.materi-att-btn{background:none;border:1.5px solid var(--exb);border-radius:6px;cursor:pointer;padding:2px 6px;font-size:.66rem;color:#9a7ac8;transition:.15s;font-weight:700;}
.materi-att-btn:hover{background:var(--exd);border-color:#b899e0;color:#9b6fd4;}
.materi-del{background:none;border:none;cursor:pointer;color:#d0b8f8;font-size:.66rem;padding:2px 5px;border-radius:5px;transition:.15s;opacity:0;}
.materi-main:hover .materi-del{opacity:1;}
.materi-del:hover{background:var(--exd);color:#9b6fd4;}
.materi-attachments{display:none;flex-wrap:wrap;gap:.32rem;padding:.35rem .68rem .42rem;background:rgba(240,234,255,.5);border-top:1px dashed var(--exb);}
.materi-attachments.open{display:flex;align-items:center;}
body.night .materi-main{background:linear-gradient(135deg,#1e1535,#18102a);}
body.night .materi-item{border-color:#4a3570;}

.materi-progress{margin-top:.48rem;display:flex;align-items:center;gap:.8rem;}
.materi-pbar{flex:1;height:6px;background:var(--exd);border-radius:99px;overflow:hidden;}
.materi-pfill{height:100%;background:linear-gradient(90deg,#b899e0,#9b6fd4);border-radius:99px;transition:width .4s ease;}
.materi-ppct{font-size:.73rem;font-weight:700;color:#9b6fd4;}

.add-materi-btn{display:flex;align-items:center;gap:.58rem;padding:.42rem .68rem;background:rgba(155,111,212,.07);border:1.5px dashed #b899e0;border-radius:10px;cursor:pointer;transition:all .2s;color:#9a7ac8;font-size:.8rem;font-weight:600;}
.add-materi-btn:hover{background:var(--exd);color:#9b6fd4;}
.exam-notes-ta{margin-top:.55rem;border-color:var(--exb)!important;}
.exam-notes-ta:focus{border-color:#b899e0!important;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALENDAR MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#cal-modal-overlay{position:fixed;inset:0;background:rgba(46,20,96,.25);backdrop-filter:blur(8px);z-index:400;display:flex;align-items:center;justify-content:center;animation:fadeIn .25s ease;}
#cal-modal-overlay.hidden{display:none;}
.cal-modal{background:linear-gradient(155deg,#f5f0ff,#fff0fa);border:1.5px solid var(--exb);border-radius:28px;padding:2rem;width:820px;max-width:94vw;max-height:88vh;overflow-y:auto;box-shadow:0 24px 72px rgba(155,111,212,.3);animation:popIn .3s ease;position:relative;}
body.night .cal-modal{background:linear-gradient(155deg,#1a1030,#1e0f18);border-color:#4a3570;}
.cal-modal-close{position:absolute;top:1.2rem;right:1.2rem;background:rgba(155,111,212,.1);border:1.5px solid var(--exb);border-radius:99px;cursor:pointer;padding:.28rem .72rem;font-size:.75rem;font-weight:700;color:#9b6fd4;transition:.15s;}
.cal-modal-close:hover{background:var(--exd);}
.cal-modal-title{font-family:'Playfair Display',serif;font-style:italic;font-size:1.55rem;color:#2e1460;margin-bottom:1.5rem;}
body.night .cal-modal-title{color:var(--td);}
.cal-nav{display:flex;align-items:center;gap:.65rem;margin-bottom:1.1rem;}
.cal-nav-btn{background:none;border:1.5px solid var(--exb);border-radius:8px;cursor:pointer;padding:.28rem .62rem;font-size:.78rem;color:#9b6fd4;font-weight:700;transition:.15s;}
.cal-nav-btn:hover{background:var(--exd);}
.cal-month-lbl{font-family:'Playfair Display',serif;font-size:1.1rem;font-weight:700;color:#2e1460;min-width:155px;text-align:center;}
body.night .cal-month-lbl{color:var(--td);}

/* TODAY button in calendar */
.cal-today-btn{padding:.28rem .85rem;border-radius:8px;border:1.5px solid var(--pkm);background:var(--pkd);cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.75rem;font-weight:700;color:var(--pk);transition:all .2s;}
.cal-today-btn:hover{background:var(--pkm);color:white;}
body.exam-mode .cal-today-btn{border-color:var(--exm);background:var(--exd);color:var(--ex);}
body.exam-mode .cal-today-btn:hover{background:var(--exm);color:white;}

.add-ev-btn{display:flex;align-items:center;gap:.48rem;padding:.45rem .95rem;border-radius:12px;border:1.5px dashed #b899e0;background:transparent;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.82rem;font-weight:600;color:#9a7ac8;transition:all .2s;margin-left:auto;}
.add-ev-btn:hover{background:var(--exd);color:#9b6fd4;border-color:#9b6fd4;}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:1.5rem;}
.cal-dow{text-align:center;font-size:.63rem;font-weight:800;letter-spacing:.1em;text-transform:uppercase;color:#9a7ac8;padding:.28rem 0;}
.cal-cell{min-height:68px;border-radius:10px;border:1.5px solid transparent;padding:.32rem;cursor:pointer;transition:all .15s;background:rgba(255,255,255,.5);}
.cal-cell:hover{border-color:var(--exb);background:var(--exp);}
.cal-cell.other-m{opacity:.3;}
.cal-cell.today-c{border-color:#9b6fd4;background:linear-gradient(135deg,var(--exp),var(--exd));}
.cal-cell.has-ev{border-color:#9b6fd4;}
.cal-date-num{font-size:.76rem;font-weight:700;color:#2e1460;margin-bottom:.18rem;}
body.night .cal-date-num{color:var(--td);}
.cal-cell.today-c .cal-date-num{color:#9b6fd4;}
.cal-ev{font-size:.6rem;font-weight:700;padding:.1rem .32rem;border-radius:4px;margin-bottom:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;}
.cal-ev.quiz-ev{background:#fff3cd;color:#856404;}
.cal-ev.uts-ev{background:#cff4fc;color:#0c5460;}
.cal-ev.uas-ev{background:#d1e7dd;color:#0f5132;}
body.night .cal-cell{background:rgba(30,15,45,.5);}
body.night .cal-cell:hover{background:rgba(60,35,90,.7);border-color:#4a3570;}
body.night .cal-cell.today-c{background:linear-gradient(135deg,#24143a,#321c50);}

.upcoming-lbl{font-size:.66rem;letter-spacing:.18em;text-transform:uppercase;color:#9a7ac8;font-weight:700;margin-bottom:.75rem;}
.upcoming-list{display:flex;flex-direction:column;gap:.55rem;}
.upcoming-item{display:flex;align-items:center;gap:.95rem;padding:.72rem 1.05rem;background:rgba(255,255,255,.8);border:1.5px solid var(--exb);border-radius:12px;backdrop-filter:blur(4px);transition:.2s;cursor:pointer;}
.upcoming-item:hover{border-color:#b899e0;box-shadow:0 2px 10px var(--exs);}
body.night .upcoming-item{background:var(--bgc);}
.upcoming-date-box{background:linear-gradient(135deg,#9b6fd4,#b899e0);color:white;border-radius:10px;padding:.38rem .62rem;text-align:center;min-width:48px;flex-shrink:0;}
.udb-day{font-family:'Playfair Display',serif;font-size:1.25rem;font-weight:700;line-height:1;}
.udb-mon{font-size:.58rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;opacity:.85;}
.upcoming-info{flex:1;}
.upcoming-name{font-size:.88rem;font-weight:700;color:#2e1460;margin-bottom:.12rem;}
body.night .upcoming-name{color:var(--td);}
.upcoming-meta{display:flex;align-items:center;gap:.45rem;font-size:.7rem;color:#9a7ac8;font-weight:600;flex-wrap:wrap;}
.upcoming-right{text-align:right;flex-shrink:0;}
.upcoming-days{font-family:'Playfair Display',serif;font-size:1.15rem;font-weight:700;color:#9b6fd4;}
.upcoming-dl{font-size:.6rem;color:#9a7ac8;font-weight:600;}
.upcoming-del{background:none;border:none;cursor:pointer;color:#d0b8f8;font-size:.73rem;padding:3px 7px;border-radius:6px;opacity:0;transition:.15s;flex-shrink:0;}
.upcoming-item:hover .upcoming-del{opacity:1;}
.upcoming-del:hover{background:var(--exd);color:#9b6fd4;}
.no-upcoming{font-size:.83rem;color:#9a7ac8;font-style:italic;font-weight:500;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay{position:fixed;inset:0;background:rgba(90,45,62,.2);backdrop-filter:blur(5px);z-index:500;display:flex;align-items:center;justify-content:center;animation:fadeIn .2s ease;}
.modal{background:linear-gradient(135deg,var(--pkp),var(--cream));border:1.5px solid var(--bdr);border-radius:20px;padding:1.75rem;width:340px;box-shadow:0 16px 48px rgba(232,120,154,.22);animation:popIn .25s ease;}
.modal h3{font-family:'Playfair Display',serif;font-style:italic;color:var(--td);font-size:1.22rem;margin-bottom:.85rem;}
.modal-sub{font-size:.76rem;color:var(--tl);font-weight:600;margin-bottom:.95rem;}
.modal input[type=text],.modal input[type=url],.modal input[type=date],.modal input[type=time],.modal select{width:100%;padding:.62rem .95rem;border:1.5px solid var(--bdr);border-radius:12px;font-family:'DM Sans',sans-serif;font-size:.86rem;font-weight:500;color:var(--td);background:white;outline:none;margin-bottom:.95rem;transition:border-color .2s;}
.modal input:focus,.modal select:focus{border-color:var(--pk);}
.modal select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23c4899d'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .9rem center;cursor:pointer;}
.modal-row{display:flex;gap:.55rem;}
.modal-row>div{flex:1;}
.modal-row input{margin-bottom:0;}
.modal-row-gap{margin-bottom:.95rem;}
.mfl{font-size:.63rem;letter-spacing:.14em;text-transform:uppercase;font-weight:700;color:var(--tl);margin-bottom:.28rem;display:block;}
.emoji-row{display:flex;gap:.42rem;flex-wrap:wrap;margin-bottom:1.05rem;}
.emoji-opt{padding:.26rem .46rem;border-radius:9px;border:1.5px solid var(--bdr);background:white;cursor:pointer;font-size:.95rem;transition:.15s;}
.emoji-opt:hover,.emoji-opt.sel{border-color:var(--pk);background:var(--pkd);}
/* Night mode emoji picker - must be clearly visible */
body.night .emoji-opt{background:rgba(80,35,55,.85);border-color:#6a3050;color:white;}
body.night .emoji-opt:hover{background:rgba(120,55,80,.9);border-color:var(--pkm);transform:scale(1.12);}
body.night .emoji-opt.sel{background:var(--pkm);border-color:var(--pk);box-shadow:0 0 0 2px rgba(232,120,154,.4);transform:scale(1.12);}
.modal-btns{display:flex;gap:.55rem;justify-content:flex-end;margin-top:.38rem;}
.btn-cancel{padding:.48rem 1.05rem;border-radius:10px;border:1.5px solid var(--bdr);background:white;color:var(--tl);cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.8rem;font-weight:600;transition:.15s;}
.btn-cancel:hover{background:var(--pkd);color:var(--tm);}
.btn-ok{padding:.48rem 1.25rem;border-radius:10px;border:none;background:linear-gradient(135deg,var(--pkm),var(--pk));color:white;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.8rem;font-weight:700;transition:.15s;box-shadow:0 2px 10px var(--shd);}
.btn-ok:hover{transform:translateY(-1px);box-shadow:0 4px 16px var(--shd);}
.btn-ok.exam{background:linear-gradient(135deg,#b899e0,#9b6fd4);box-shadow:0 2px 10px var(--exs);}
.confirm-modal{width:300px;text-align:center;}
.confirm-modal .ci{font-size:2.5rem;margin-bottom:.48rem;}
.confirm-modal h3{margin-bottom:.32rem;}
.confirm-modal p{font-size:.81rem;color:var(--tl);font-weight:500;margin-bottom:1.2rem;line-height:1.6;}
.confirm-modal p strong{color:var(--tm);}
.confirm-modal .modal-btns{justify-content:center;gap:.75rem;}
.btn-del{padding:.48rem 1.25rem;border-radius:10px;border:none;background:linear-gradient(135deg,var(--pkm),var(--pk));color:white;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.8rem;font-weight:700;transition:.15s;box-shadow:0 2px 10px var(--shd);}
.btn-del:hover{transform:translateY(-1px);filter:brightness(1.06);}
.modal-wide{width:385px;}
.sslist{display:flex;flex-direction:column;gap:.38rem;max-height:195px;overflow-y:auto;margin-bottom:.95rem;}
.ssi{display:flex;align-items:center;gap:.48rem;padding:.48rem .72rem;border-radius:10px;border:1.5px solid var(--bdr);background:white;cursor:pointer;font-size:.83rem;font-weight:600;color:var(--tm);transition:.15s;}
.ssi:hover{border-color:var(--pkm);background:var(--pkd);color:var(--pk);}
.ssi.sel{border-color:var(--pk);background:var(--pkd);color:var(--pk);}

/* night modal overrides */
body.night .modal{background:linear-gradient(135deg,#2a1520,#160810);border-color:var(--bdr);}
body.night .modal input[type=text],body.night .modal input[type=url],body.night .modal input[type=date],body.night .modal input[type=time],body.night .modal select{background:rgba(58,25,40,.9);border-color:var(--bdr);color:var(--td);}
body.night .emoji-opt{background:rgba(58,25,40,.7);border-color:var(--bdr);}
body.night .btn-cancel{background:rgba(58,25,40,.7);border-color:var(--bdr);color:var(--td);}
body.night .ssi{background:rgba(30,15,45,.6);border-color:var(--bdr);color:var(--td);}
body.night .ssi:hover,.body.night .ssi.sel{background:rgba(55,30,75,.7);border-color:var(--pkm);}

/* night content overrides */
body.night .notes-ta{background:rgba(30,10,20,.9);color:var(--td);border-color:var(--bdr);}
body.night .sbtn{background:rgba(45,18,30,.9);border-color:var(--bdr);}
body.night .sbtn.a-untouched{background:#3d1e1e;border-color:#a03030;color:#f08080;}
body.night .sbtn.a-on-progress{background:#3d3010;border-color:#b8870a;color:#f4c23a;}
body.night .sbtn.a-done{background:#1a2a3d;border-color:#5a9fe0;color:#90c0f0;}
body.night .sbtn.a-submitted{background:#1a3d2a;border-color:#5ec47e;color:#90e0a8;}
body.night .start-pill,body.night .deadline-pill{background:rgba(45,18,30,.9);border-color:var(--bdr);}
body.night .task-attach{background:linear-gradient(135deg,rgba(35,12,22,.9),rgba(45,18,30,.8));}
body.night .add-task-row{background:rgba(35,12,22,.6);}
body.night .file-chip{background:linear-gradient(135deg,#2e1522,#3e1e2e);}
body.night .link-chip{background:linear-gradient(135deg,#1a2035,#1e2840);border-color:#3a5080;color:#90b8e8;}
body.night .add-link-inp{background:rgba(45,18,30,.9);border-color:var(--bdr);color:var(--td);}
body.night .add-link-ok{background:#1e2840;border-color:#3a5080;color:#90b8e8;}
body.night .today-btn{background:var(--pkd);color:var(--pk);}
body.night .countdown-box{background:linear-gradient(135deg,#1a0e2e,#2e1a50);}
body.night .add-chip-btn{background:rgba(45,18,30,.7);border-color:var(--bdr);}
body.night .link-inp,.body.night .open-btn,.body.night .submit-toggle{background:rgba(45,18,30,.9);border-color:var(--bdr);color:var(--td);}
body.night .ta-inp{background:rgba(45,18,30,.9);border-color:var(--bdr);color:var(--td);}

/* â”€â”€ Loading â”€â”€ */
#loading-screen{position:fixed;inset:0;z-index:999;background:linear-gradient(135deg,#fff5f9,#fde8f0,#fff8fc);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.2rem;transition:opacity .5s ease;}
#loading-screen.fade-out{opacity:0;pointer-events:none;}
.loading-title{font-family:'Playfair Display',serif;font-style:italic;font-size:2rem;color:#e8789a;text-shadow:0 2px 16px #f4a7c066;}
.loading-ribbons{position:relative;width:160px;height:120px;}
.lr{position:absolute;font-size:2rem;}
.lr1{top:0;left:50%;transform:translateX(-50%);animation:lr1 1.1s ease-in-out infinite;}
.lr2{top:20px;left:10px;animation:lr2 1.3s ease-in-out infinite;}
.lr3{top:20px;right:10px;animation:lr3 1.3s ease-in-out infinite .15s;}
.lr4{bottom:0;left:20px;animation:lr4 1s ease-in-out infinite .3s;}
.lr5{bottom:0;right:20px;animation:lr4 1s ease-in-out infinite .5s;}
@keyframes lr1{0%,100%{transform:translateX(-50%) translateY(0) rotate(-8deg) scale(1)}50%{transform:translateX(-50%) translateY(-18px) rotate(8deg) scale(1.15)}}
@keyframes lr2{0%,100%{transform:rotate(-20deg) scale(1)}50%{transform:rotate(15deg) scale(1.1) translateY(-10px)}}
@keyframes lr3{0%,100%{transform:rotate(20deg) scale(1)}50%{transform:rotate(-15deg) scale(1.1) translateY(-10px)}}
@keyframes lr4{0%,100%{transform:translateY(0) rotate(-5deg)}50%{transform:translateY(-14px) rotate(6deg)}}
.loading-dots{display:flex;gap:6px;}
.loading-dot{width:7px;height:7px;border-radius:50%;background:var(--pkm);animation:ldot 1s ease-in-out infinite;}
.loading-dot:nth-child(2){animation-delay:.18s;}
.loading-dot:nth-child(3){animation-delay:.36s;}
@keyframes ldot{0%,80%,100%{transform:scale(.7);opacity:.5}40%{transform:scale(1.2);opacity:1}}
.loading-sub{font-size:.73rem;color:var(--tl);font-weight:700;letter-spacing:.15em;text-transform:uppercase;}

/* lightbox */
.lightbox{position:fixed;inset:0;background:rgba(46,20,62,.75);z-index:600;display:flex;align-items:center;justify-content:center;animation:fadeIn .2s ease;cursor:zoom-out;}
.lightbox img{max-width:90vw;max-height:88vh;border-radius:16px;box-shadow:0 8px 48px rgba(0,0,0,.4);}

::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--pkm);border-radius:99px}
</style>
</head>
<body>

<!-- Loading -->
<div id="loading-screen">
  <div class="loading-ribbons">
    <span class="lr lr1">ğŸ€</span><span class="lr lr2">ğŸŒ¸</span><span class="lr lr3">ğŸ’•</span>
    <span class="lr lr4">ğŸ€</span><span class="lr lr5">ğŸŒ·</span>
  </div>
  <div class="loading-title">Sha-Desk ğŸ€</div>
  <div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
  <div class="loading-sub">loading your workspace~</div>
</div>

<!-- Mode Selector -->
<div id="mode-selector" class="hidden">
  <div class="ms-inner">

    <div class="ms-logo">Sha-Desk <span class="ms-logo-bow">ğŸ€</span></div>
    <div class="ms-sub">what are we working on today?</div>

    <div class="ms-cards">

      <!-- â”€â”€ HW Card â”€â”€ -->
      <div class="ms-card hw-card" onclick="selectMode('hw')">

        <!-- Animated SVG bow on top -->
        <div class="ms-card-bow">
          <svg width="68" height="38" viewBox="0 0 68 38" fill="none" xmlns="http://www.w3.org/2000/svg">
            <ellipse cx="17" cy="19" rx="16" ry="9" fill="#e8789a" opacity=".9" transform="rotate(-10,17,19)"/>
            <ellipse cx="17" cy="19" rx="10" ry="5.5" fill="#f4a0bc" opacity=".75" transform="rotate(-10,17,19)"/>
            <ellipse cx="51" cy="19" rx="16" ry="9" fill="#e8789a" opacity=".9" transform="rotate(10,51,19)"/>
            <ellipse cx="51" cy="19" rx="10" ry="5.5" fill="#f4a0bc" opacity=".75" transform="rotate(10,51,19)"/>
            <ellipse cx="34" cy="19" rx="5.5" ry="6.5" fill="#f7bdd0"/>
            <ellipse cx="34" cy="19" rx="3" ry="4" fill="#e8789a"/>
            <path d="M29.5 24.5 Q27 33 23 37" stroke="#e8789a" stroke-width="2.2" stroke-linecap="round" opacity=".85"/>
            <path d="M38.5 24.5 Q41 33 45 37" stroke="#e8789a" stroke-width="2.2" stroke-linecap="round" opacity=".85"/>
          </svg>
        </div>

        <!-- Gingham background -->
        <div class="ms-card-bg"></div>

        <!-- Wavy ribbon SVG frame -->
        <svg class="ms-card-frame" viewBox="0 0 195 240" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
          <path d="
            M 22,14
            Q 30,6 42,10 Q 54,14 66,9 Q 78,4 90,9 Q 102,14 114,9 Q 126,4 138,9 Q 150,14 162,10 Q 174,6 178,14
            L 183,22
            Q 191,34 186,46 Q 181,58 188,70 Q 195,82 188,94 Q 181,106 188,118 Q 195,130 188,142 Q 181,154 188,166 Q 195,178 188,190 Q 181,202 183,214
            L 178,224
            Q 174,232 162,228 Q 150,224 138,229 Q 126,234 114,229 Q 102,224 90,229 Q 78,234 66,229 Q 54,224 42,228 Q 30,232 22,224
            L 14,214
            Q 6,202 10,190 Q 14,178 7,166 Q 0,154 7,142 Q 14,130 7,118 Q 0,106 7,94 Q 14,82 7,70 Q 0,58 7,46 Q 14,34 14,22 Z
          " fill="none" stroke="#e8789a" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"/>
          <!-- Corner tiny hearts -->
          <text x="8" y="26" font-size="8" fill="#e8789a" opacity=".55">â™¡</text>
          <text x="177" y="26" font-size="8" fill="#e8789a" opacity=".55">â™¡</text>
          <text x="8" y="222" font-size="8" fill="#e8789a" opacity=".55">â™¡</text>
          <text x="177" y="222" font-size="8" fill="#e8789a" opacity=".55">â™¡</text>
        </svg>

        <div class="ms-card-icon">ğŸ©·</div>
        <div class="ms-card-title">Homework</div>
        <div class="ms-card-tagline">your digital study desk</div>
        <div class="ms-card-desc">assignments, tasks & submissions</div>
      </div>

      <!-- â”€â”€ EXAM Card â”€â”€ -->
      <div class="ms-card exam-card" onclick="selectMode('exam')">

        <!-- Animated bow â€” slightly different color/timing -->
        <div class="ms-card-bow">
          <svg width="68" height="38" viewBox="0 0 68 38" fill="none" xmlns="http://www.w3.org/2000/svg">
            <ellipse cx="17" cy="19" rx="16" ry="9" fill="#c87090" opacity=".9" transform="rotate(-10,17,19)"/>
            <ellipse cx="17" cy="19" rx="10" ry="5.5" fill="#e8a0b8" opacity=".75" transform="rotate(-10,17,19)"/>
            <ellipse cx="51" cy="19" rx="16" ry="9" fill="#c87090" opacity=".9" transform="rotate(10,51,19)"/>
            <ellipse cx="51" cy="19" rx="10" ry="5.5" fill="#e8a0b8" opacity=".75" transform="rotate(10,51,19)"/>
            <ellipse cx="34" cy="19" rx="5.5" ry="6.5" fill="#f0b8cc"/>
            <ellipse cx="34" cy="19" rx="3" ry="4" fill="#c87090"/>
            <path d="M29.5 24.5 Q27 33 23 37" stroke="#c87090" stroke-width="2.2" stroke-linecap="round" opacity=".85"/>
            <path d="M38.5 24.5 Q41 33 45 37" stroke="#c87090" stroke-width="2.2" stroke-linecap="round" opacity=".85"/>
          </svg>
        </div>

        <!-- Polka dot / hearts background -->
        <div class="ms-card-bg"></div>

        <!-- Wavy ribbon SVG frame â€” slightly different wave -->
        <svg class="ms-card-frame" viewBox="0 0 195 240" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
          <path d="
            M 22,14
            Q 30,6 42,10 Q 54,14 66,9 Q 78,4 90,9 Q 102,14 114,9 Q 126,4 138,9 Q 150,14 162,10 Q 174,6 178,14
            L 183,22
            Q 191,34 186,46 Q 181,58 188,70 Q 195,82 188,94 Q 181,106 188,118 Q 195,130 188,142 Q 181,154 188,166 Q 195,178 188,190 Q 181,202 183,214
            L 178,224
            Q 174,232 162,228 Q 150,224 138,229 Q 126,234 114,229 Q 102,224 90,229 Q 78,234 66,229 Q 54,224 42,228 Q 30,232 22,224
            L 14,214
            Q 6,202 10,190 Q 14,178 7,166 Q 0,154 7,142 Q 14,130 7,118 Q 0,106 7,94 Q 14,82 7,70 Q 0,58 7,46 Q 14,34 14,22 Z
          " fill="none" stroke="#c87090" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"/>
          <text x="8" y="26" font-size="8" fill="#c87090" opacity=".55">âœ¦</text>
          <text x="178" y="26" font-size="8" fill="#c87090" opacity=".55">âœ¦</text>
          <text x="8" y="222" font-size="8" fill="#c87090" opacity=".55">âœ¦</text>
          <text x="178" y="222" font-size="8" fill="#c87090" opacity=".55">âœ¦</text>
        </svg>

        <div class="ms-card-icon">ğŸ“š</div>
        <div class="ms-card-title">Exam Prep</div>
        <div class="ms-card-tagline">your digital study desk</div>
        <div class="ms-card-desc">study materials, quiz & UTS/UAS</div>
      </div>

    </div>
  </div>
</div>

<div class="ribbon" id="r1">ğŸ€</div>
<div class="ribbon" id="r2">ğŸŒ¸</div>
<div class="ribbon" id="r3">ğŸ’•</div>
<div class="ribbon" id="r4">ğŸ€</div>

<header>
  <button class="icon-btn" id="sb-toggle">â˜°</button>
  <div class="header-center">
    <div class="logo">Sha-Desk <span>ğŸ€</span></div>
    <div class="tagline" id="tagline">your digital study desk âœ¨</div>
    <div id="mode-badge-wrap"></div>
  </div>
  <button class="icon-btn" id="night-btn">ğŸŒ™</button>
</header>

<div class="app">
  <aside class="sidebar" id="sidebar">
    <div id="pinned-wrap"></div>
    <div class="sb-label" id="sb-label">ğŸ“š Subjects</div>
    <div id="matkul-list"></div>
    <button class="add-matkul-btn" id="add-matkul-btn">âœ¦ add subject</button>
    <div id="cal-btn-wrap"></div>
  </aside>
  <main class="content" id="main-content">
    <div class="empty-state">
      <div class="empty-icon">ğŸŒ¸</div>
      <div class="empty-text">pick an assignment from the sidebar~</div>
    </div>
  </main>
</div>

<!-- Context Menu -->
<div class="ctx-menu" id="ctx-menu" style="display:none"></div>

<!-- Calendar Modal -->
<div id="cal-modal-overlay" class="hidden">
  <div class="cal-modal">
    <button class="cal-modal-close" onclick="closeCal()">âœ• close</button>
    <div class="cal-modal-title">ğŸ—“ï¸ exam schedule</div>
    <div style="display:flex;align-items:center;gap:.6rem;margin-bottom:1.1rem;flex-wrap:wrap;">
      <button class="cal-nav-btn" id="cal-prev">â€¹</button>
      <div class="cal-month-lbl" id="cal-month-lbl"></div>
      <button class="cal-nav-btn" id="cal-next">â€º</button>
      <button class="cal-today-btn" id="cal-today-btn">today</button>
      <button class="add-ev-btn" id="add-ev-btn">ï¼‹ add exam</button>
    </div>
    <div class="cal-grid" id="cal-grid"></div>
    <div class="upcoming-lbl">â­ upcoming exams</div>
    <div class="upcoming-list" id="upcoming-list"></div>
  </div>
</div>

<!-- Modal: Subject -->
<div class="modal-overlay" id="modal-subject" style="display:none">
  <div class="modal">
    <h3 id="ms-title">new subject ğŸ“š</h3>
    <input type="text" id="subject-name-inp" placeholder="subject name..." maxlength="40" />
    <div class="emoji-row" id="emoji-subject"></div>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal('modal-subject')">cancel</button>
      <button class="btn-ok" id="btn-subject-ok">create âœ¦</button>
    </div>
  </div>
</div>

<!-- Modal: New HW Assignment -->
<div class="modal-overlay" id="modal-hw" style="display:none">
  <div class="modal">
    <h3>new assignment ğŸ€</h3>
    <p class="modal-sub" id="modal-hw-sub">in: <strong></strong></p>
    <input type="text" id="hw-name-inp" placeholder="assignment title..." maxlength="50" />
    <div class="emoji-row" id="emoji-hw"></div>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal('modal-hw')">cancel</button>
      <button class="btn-ok" onclick="createHW()">create âœ¦</button>
    </div>
  </div>
</div>

<!-- Modal: New Exam Folder -->
<div class="modal-overlay" id="modal-exam-folder" style="display:none">
  <div class="modal">
    <h3>new exam folder ğŸ“–</h3>
    <p class="modal-sub" id="modal-ef-sub">in: <strong></strong></p>
    <label class="mfl">exam type</label>
    <select id="ef-type-sel">
      <option value="quiz1">Quiz 1</option><option value="quiz2">Quiz 2</option>
      <option value="quiz3">Quiz 3</option><option value="quiz4">Quiz 4</option>
      <option value="quiz5">Quiz 5</option><option value="quiz6">Quiz 6</option>
      <option value="uts">UTS</option><option value="uas">UAS</option>
    </select>
    <input type="text" id="ef-name-inp" placeholder="custom name (optional)..." maxlength="50" />
    <div class="emoji-row" id="emoji-ef"></div>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal('modal-exam-folder')">cancel</button>
      <button class="btn-ok exam" onclick="createEF()">create âœ¦</button>
    </div>
  </div>
</div>

<!-- Modal: Add Exam Event -->
<div class="modal-overlay" id="modal-exam-event" style="display:none">
  <div class="modal modal-wide">
    <h3>add exam schedule ğŸ—“ï¸</h3>
    <label class="mfl">select exam folder</label>
    <select id="ev-folder-sel"></select>
    <div class="modal-row modal-row-gap">
      <div><label class="mfl">date</label><input type="date" id="ev-date" /></div>
      <div><label class="mfl">time</label><input type="time" id="ev-time" /></div>
    </div>
    <label class="mfl">room / location</label>
    <input type="text" id="ev-room" placeholder="e.g. Gedung A lt.3 / Online" />
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal('modal-exam-event')">cancel</button>
      <button class="btn-ok exam" onclick="createEV()">add âœ¦</button>
    </div>
  </div>
</div>

<!-- Modal: Move -->
<div class="modal-overlay" id="modal-move" style="display:none">
  <div class="modal modal-wide">
    <h3 id="move-title">move to... ğŸ“‚</h3>
    <div class="sslist" id="move-list"></div>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal('modal-move')">cancel</button>
      <button class="btn-ok" id="btn-move-ok">move âœ¦</button>
    </div>
  </div>
</div>

<!-- Modal: Confirm -->
<div class="modal-overlay" id="modal-confirm" style="display:none">
  <div class="modal confirm-modal">
    <div class="ci">ğŸ—‘ï¸</div>
    <h3 id="confirm-title">are you sure?</h3>
    <p id="confirm-msg">this will be gone forever~</p>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal('modal-confirm')">never mind ğŸ™ˆ</button>
      <button class="btn-del" id="btn-confirm-ok">delete âœ¦</button>
    </div>
  </div>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox" style="display:none" onclick="closeLightbox()">
  <img id="lightbox-img" src="" alt="" />
</div>

<!-- Custom Coquette Date/Time Picker -->
<div id="cq-picker-overlay" class="hidden">
  <div class="cq-picker">
    <div class="cq-picker-title">ğŸ€ pick a date</div>
    <div class="cq-cal-nav">
      <button class="cq-cal-nav-btn" id="cq-prev">â€¹</button>
      <div class="cq-month-lbl" id="cq-month-lbl"></div>
      <button class="cq-cal-nav-btn" id="cq-next">â€º</button>
    </div>
    <div class="cq-cal-grid" id="cq-cal-grid"></div>
    <div class="cq-time-row" id="cq-time-row">
      <span class="cq-time-lbl">â° time</span>
      <input type="number" class="cq-time-inp" id="cq-hr" min="0" max="23" placeholder="HH"/>
      <span class="cq-colon">:</span>
      <input type="number" class="cq-time-inp" id="cq-mn" min="0" max="59" placeholder="MM"/>
    </div>
    <div class="cq-btns">
      <button class="cq-btn-cancel" id="cq-cancel">cancel</button>
      <button class="cq-btn-ok" id="cq-ok">set date âœ¦</button>
    </div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONSTANTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Subject emojis: math-related
const E_SUBJECT = ['ğŸ§®','ğŸ“','ğŸ“','ğŸ”¬','âš—ï¸','ğŸ§¬','ğŸ”­','ğŸ’»','ğŸ“Š','ğŸ“ˆ','ğŸŒ','âš–ï¸','ğŸ›ï¸','ğŸµ','ğŸ©º','ğŸ“¡'];
// HW emojis: coquette
const E_HW      = ['ğŸ€','ğŸ©·','ğŸŒ¸','ğŸª','ğŸ’Œ','ğŸŒ·','ğŸ©°','ğŸ§','ğŸ’—','ğŸ«¶','ğŸª„','ğŸ’','ğŸ¦¢','ğŸ“','ğŸŒº','ğŸª»'];
const E_EXAM    = ['ğŸ“–','ğŸ¯','ğŸ“‹','âœï¸','ğŸ“','ğŸ§®','â­','ğŸ“','ğŸ”¬','ğŸ’¡','ğŸ†','âš¡'];
const STATUSES  = [
  {k:'untouched',  l:'Untouched',   d:'#e05555', ac:'a-untouched'},
  {k:'on-progress',l:'On Progress', d:'#f4c23a', ac:'a-on-progress'},
  {k:'done',       l:'Done',        d:'#5a9fe0', ac:'a-done'},
  {k:'submitted',  l:'Submitted',   d:'#5ec47e', ac:'a-submitted'},
];
const EXAM_TYPES = {quiz1:'Quiz 1',quiz2:'Quiz 2',quiz3:'Quiz 3',quiz4:'Quiz 4',quiz5:'Quiz 5',quiz6:'Quiz 6',uts:'UTS',uas:'UAS'};
const SB_URL = 'https://oqqhbmjyxquzegxhjxcu.supabase.co';
const SB_KEY = 'sb_publishable_Fjg-gf-QFDQsjQX1S_GQdw_Eu2mamT7';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let subjects   = [];
let examEvents = [];
let mode = 'hw';

let activeSid = null, activeAid = null;
let activeESid = null, activeEFid = null;

let _pendingSid = null, _pendingESid = null;
let _selEmojiS = 'ğŸ§®', _selEmojiHW = 'ğŸ€', _selEmojiEF = 'ğŸ“–';
let _saveT = null, _cdInt = null;
let _calMonth = new Date();
let _moveData = null, _moveSel = null;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUPABASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadDB(){
  try {
    const r = await fetch(`${SB_URL}/rest/v1/data?id=eq.main&select=content`,
      {headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY}});
    const rows = await r.json();
    if(rows&&rows.length&&rows[0].content){
      const d = rows[0].content;
      if(Array.isArray(d)){
        subjects = d.map(s=>({...s, exams:s.exams||[]}));
      } else if(d.subjects){
        subjects   = (d.subjects||[]).map(s=>({...s, exams:s.exams||[]}));
        examEvents = d.examEvents||[];
      } else {
        subjects   = (d.subjects||d||[]).map(s=>({...s, exams:s.exams||[]}));
        examEvents = d.examEvents||[];
      }
    }
  } catch(e){console.error('load',e);}
}
async function _doSave(){
  try {
    await fetch(`${SB_URL}/rest/v1/data?id=eq.main`,{
      method:'PATCH',
      headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':'application/json','Prefer':'return=minimal'},
      body: JSON.stringify({content:{subjects,examEvents},updated_at:new Date().toISOString()})
    });
  } catch(e){console.error('save',e);}
}
function save(){clearTimeout(_saveT);_saveT=setTimeout(_doSave,800);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const uid  = ()=>Date.now().toString(36)+Math.random().toString(36).slice(2,6);
const iso  = ()=>new Date().toISOString().slice(0,10);
const esc  = s=>String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const getSub  = id=>subjects.find(s=>s.id===id);
const getHW   = (sid,aid)=>{const s=getSub(sid);return s?s.assignments.find(a=>a.id===aid):null;};
const getEF   = (sid,fid)=>{const s=getSub(sid);return s?s.exams.find(f=>f.id===fid):null;};
const typeClass= t=>(t==='uts'?'uts':t==='uas'?'uas':'quiz');
const findEF   = fid=>{for(const s of subjects)for(const f of(s.exams||[]))if(f.id===fid)return{s,f};return null;};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODE SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showModeSelector(){
  document.getElementById('mode-selector').classList.remove('hidden');
  _spawnPetals();
}

function _spawnPetals(){
  const ms = document.getElementById('mode-selector');
  ms.querySelectorAll('.ms-petal').forEach(p=>p.remove());
  const symbols = ['ğŸŒ¸','ğŸŒ·','âœ¿','â€','ğŸŒ¹'];
  for(let i=0;i<10;i++){
    const p = document.createElement('div');
    p.className='ms-petal';
    p.textContent = symbols[Math.floor(Math.random()*symbols.length)];
    p.style.left = (Math.random()*96)+'%';
    p.style.animationName = 'msPetal';
    p.style.animationDuration = (7+Math.random()*10)+'s';
    p.style.animationDelay = (Math.random()*14)+'s';
    p.style.fontSize = (.5+Math.random()*.65)+'rem';
    p.style.opacity = .15+Math.random()*.18;
    ms.appendChild(p);
  }
}
function selectMode(m){
  mode=m; localStorage.setItem('sha-mode',m);
  document.getElementById('mode-selector').classList.add('hidden');
  applyMode();
}
function applyMode(){
  const isE = mode==='exam';
  document.body.classList.toggle('exam-mode',isE);
  ['r1','r2','r3','r4'].forEach((id,i)=>{
    const emojis = isE?['ğŸ“š','âœï¸','â­','ğŸ“–']:['ğŸ€','ğŸŒ¸','ğŸ’•','ğŸŒ·'];
    const el=document.getElementById(id); if(el)el.textContent=emojis[i];
  });
  document.getElementById('tagline').textContent = isE?'exam preparation mode ğŸ“–':'your digital study desk âœ¨';
  document.getElementById('mode-badge-wrap').innerHTML = `<div class="mode-badge ${isE?'exam':'hw'}" onclick="showModeSelector()" title="switch mode">${isE?'ğŸ“š exam prep':'ğŸ“ homework'} â†•</div>`;
  document.getElementById('sb-label').textContent = isE?'ğŸ“– Exam Subjects':'ğŸ“š Subjects';
  const addBtn = document.getElementById('add-matkul-btn');
  addBtn.textContent = isE?'âœ¦ add exam subject':'âœ¦ add subject';
  addBtn.onclick = ()=>openSubModal(isE?'exam':'hw');
  const calWrap = document.getElementById('cal-btn-wrap');
  calWrap.innerHTML = isE?`<button class="cal-sidebar-btn" onclick="openCal()">ğŸ—“ï¸ exam schedule</button>`:'';
  renderSidebar();
  renderEmpty();
}
function renderEmpty(){
  const e=mode==='exam';
  document.getElementById('main-content').innerHTML=`<div class="empty-state"><div class="empty-icon">${e?'ğŸ“–':'ğŸŒ¸'}</div><div class="empty-text">${e?'pick an exam folder from the sidebar~':'pick an assignment from the sidebar~'}</div></div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS CORE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function closeModal(id){document.getElementById(id).style.display='none';}
['modal-subject','modal-hw','modal-confirm','modal-exam-folder','modal-exam-event','modal-move'].forEach(id=>{
  document.getElementById(id).addEventListener('click',function(e){if(e.target===this)closeModal(id);});
});
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){
    ['modal-subject','modal-hw','modal-confirm','modal-exam-folder','modal-exam-event','modal-move'].forEach(id=>closeModal(id));
    closeLightbox(); closeCtx(); closeCal();
  }
});
function askDelete(title,msg,cb){
  document.getElementById('confirm-title').textContent=title;
  document.getElementById('confirm-msg').innerHTML=msg;
  document.getElementById('modal-confirm').style.display='flex';
  const old=document.getElementById('btn-confirm-ok'),fresh=old.cloneNode(true);old.replaceWith(fresh);
  fresh.addEventListener('click',()=>{closeModal('modal-confirm');cb();});
}
function openLightbox(s){document.getElementById('lightbox-img').src=s;document.getElementById('lightbox').style.display='flex';}
function closeLightbox(){document.getElementById('lightbox').style.display='none';}
function mkEmojiPicker(rowId,emojis,cur,set){
  const row=document.getElementById(rowId);if(!row)return;row.innerHTML='';
  emojis.forEach(e=>{const b=document.createElement('button');b.className='emoji-opt'+(e===cur?' sel':'');b.textContent=e;b.onclick=()=>{set(e);mkEmojiPicker(rowId,emojis,e,set);};row.appendChild(b);});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBJECT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openSubModal(type){
  _selEmojiS='ğŸ§®';
  document.getElementById('ms-title').textContent = type==='exam'?'new exam subject ğŸ“–':'new subject ğŸ“š';
  document.getElementById('subject-name-inp').value='';
  mkEmojiPicker('emoji-subject',E_SUBJECT,_selEmojiS,v=>_selEmojiS=v);
  document.getElementById('modal-subject').style.display='flex';
  const btn=document.getElementById('btn-subject-ok');
  const fresh=btn.cloneNode(true);btn.replaceWith(fresh);
  fresh.onclick=()=>{
    const name=document.getElementById('subject-name-inp').value.trim();
    if(!name){document.getElementById('subject-name-inp').focus();return;}
    subjects.push({id:uid(),name,icon:_selEmojiS,open:true,assignments:[],exams:[]});
    save();closeModal('modal-subject');renderSidebar();
  };
  setTimeout(()=>document.getElementById('subject-name-inp').focus(),60);
}
document.getElementById('subject-name-inp').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('btn-subject-ok').click();});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HW ASSIGNMENT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openHWModal(sid){
  _pendingSid=sid;_selEmojiHW='ğŸ€';
  const s=getSub(sid);
  document.getElementById('hw-name-inp').value='';
  document.getElementById('modal-hw-sub').innerHTML=`in: <strong>${esc(s.name)}</strong>`;
  mkEmojiPicker('emoji-hw',E_HW,_selEmojiHW,v=>_selEmojiHW=v);
  document.getElementById('modal-hw').style.display='flex';
  setTimeout(()=>document.getElementById('hw-name-inp').focus(),60);
}
document.getElementById('hw-name-inp').addEventListener('keydown',e=>{if(e.key==='Enter')createHW();});
function createHW(){
  const name=document.getElementById('hw-name-inp').value.trim();if(!name){document.getElementById('hw-name-inp').focus();return;}
  const s=getSub(_pendingSid);if(!s)return;
  const a={id:uid(),name,icon:_selEmojiHW,status:'untouched',submitted:false,submitLink:'',
    tasks:[],materialFiles:[],materialLinks:[],questionFiles:[],questionLinks:[],
    startDate:null,dueDate:null,dueTime:null,createdAt:iso(),notes:'',
    folderAttachments:[],folderLinks:[],pinned:false};
  s.assignments.push(a);s.open=true;
  save();closeModal('modal-hw');
  activeSid=_pendingSid;activeAid=a.id;
  renderSidebar();renderHW();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXAM FOLDER MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openEFModal(sid){
  _pendingESid=sid;_selEmojiEF='ğŸ“–';
  const s=getSub(sid);
  document.getElementById('ef-name-inp').value='';
  document.getElementById('modal-ef-sub').innerHTML=`in: <strong>${esc(s.name)}</strong>`;
  document.getElementById('ef-type-sel').value='quiz1';
  mkEmojiPicker('emoji-ef',E_EXAM,_selEmojiEF,v=>_selEmojiEF=v);
  document.getElementById('modal-exam-folder').style.display='flex';
  setTimeout(()=>document.getElementById('ef-name-inp').focus(),60);
}
document.getElementById('ef-name-inp').addEventListener('keydown',e=>{if(e.key==='Enter')createEF();});
function createEF(){
  const s=getSub(_pendingESid);if(!s)return;
  const type=document.getElementById('ef-type-sel').value;
  const custom=document.getElementById('ef-name-inp').value.trim();
  const name=custom||EXAM_TYPES[type];
  const f={id:uid(),name,icon:_selEmojiEF,examType:type,
    examDate:null,examTime:null,examRoom:'',
    materiList:[],mainSource:'',pptLink:'',examCollections:'',notes:''};
  s.exams.push(f);s.open=true;
  save();closeModal('modal-exam-folder');
  activeESid=_pendingESid;activeEFid=f.id;
  renderSidebar();renderExam();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXAM EVENT MODAL - SYNCED WITH FOLDER DATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openEVModal(prefill=null){
  const sel=document.getElementById('ev-folder-sel');sel.innerHTML='';
  subjects.forEach(s=>(s.exams||[]).forEach(f=>{
    const opt=document.createElement('option');opt.value=f.id;
    opt.textContent=`${s.icon} ${s.name} â€” ${f.name}`;
    if(f.id===prefill)opt.selected=true;
    sel.appendChild(opt);
  }));

  // Pre-fill date/time from folder if folder already has date
  const selectedFid = prefill || sel.value;
  const prefillData = findEF(selectedFid);
  document.getElementById('ev-date').value = prefillData?.f?.examDate || '';
  document.getElementById('ev-time').value = prefillData?.f?.examTime || '';
  document.getElementById('ev-room').value = prefillData?.f?.examRoom || '';

  // When folder changes, update the prefill
  sel.onchange = () => {
    const r = findEF(sel.value);
    if(r) {
      document.getElementById('ev-date').value = r.f.examDate || '';
      document.getElementById('ev-time').value = r.f.examTime || '';
      document.getElementById('ev-room').value = r.f.examRoom || '';
    }
  };

  document.getElementById('modal-exam-event').style.display='flex';
}

function createEV(){
  const fid=document.getElementById('ev-folder-sel').value;
  const date=document.getElementById('ev-date').value;
  const time=document.getElementById('ev-time').value;
  const room=document.getElementById('ev-room').value.trim();
  if(!fid||!date){alert('Please pick an exam and date~');return;}
  // SYNC: update the folder data too
  subjects.forEach(s=>(s.exams||[]).forEach(f=>{
    if(f.id===fid){f.examDate=date;f.examTime=time||null;f.examRoom=room||'';}
  }));
  const existing=examEvents.findIndex(ev=>ev.folderId===fid);
  const ev={id:uid(),folderId:fid,date,time:time||null,room:room||''};
  if(existing>=0)examEvents[existing]=ev;else examEvents.push(ev);
  save();closeModal('modal-exam-event');
  renderCalContent();
  if(activeEFid===fid)renderExam();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOVE MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openMoveModal(type,sid,id){
  _moveData={type,sid,id};_moveSel=null;
  const list=document.getElementById('move-list');list.innerHTML='';
  subjects.forEach(s=>{
    if(s.id===sid)return;
    const item=document.createElement('div');item.className='ssi';
    item.innerHTML=`<span>${s.icon}</span><span>${esc(s.name)}</span>`;
    item.dataset.sid=s.id;
    item.addEventListener('click',()=>{list.querySelectorAll('.ssi').forEach(el=>el.classList.remove('sel'));item.classList.add('sel');_moveSel=s.id;});
    list.appendChild(item);
  });
  document.getElementById('modal-move').style.display='flex';
  const btn=document.getElementById('btn-move-ok');
  const fresh=btn.cloneNode(true);btn.replaceWith(fresh);
  fresh.addEventListener('click',()=>{
    if(!_moveSel||!_moveData){closeModal('modal-move');return;}
    const {type,sid,id}=_moveData;
    const fromS=getSub(sid),toS=getSub(_moveSel);if(!fromS||!toS)return;
    if(type==='hw'){
      const idx=fromS.assignments.findIndex(a=>a.id===id);if(idx<0)return;
      const [item]=fromS.assignments.splice(idx,1);toS.assignments.push(item);
      if(activeAid===id){activeSid=_moveSel;}
    } else {
      const idx=fromS.exams.findIndex(f=>f.id===id);if(idx<0)return;
      const [item]=fromS.exams.splice(idx,1);toS.exams.push(item);
      if(activeEFid===id){activeESid=_moveSel;}
    }
    save();closeModal('modal-move');renderSidebar();
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DUPLICATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function dupHW(sid,aid){
  const s=getSub(sid);const a=getHW(sid,aid);if(!s||!a)return;
  const d=JSON.parse(JSON.stringify(a));d.id=uid();d.name='Copy of '+d.name;d.createdAt=iso();
  s.assignments.push(d);save();renderSidebar();
}
function dupEF(sid,fid){
  const s=getSub(sid);const f=getEF(sid,fid);if(!s||!f)return;
  const d=JSON.parse(JSON.stringify(f));d.id=uid();d.name='Copy of '+d.name;
  s.exams.push(d);save();renderSidebar();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTEXT MENU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function closeCtx(){const m=document.getElementById('ctx-menu');m.style.display='none';m.innerHTML='';}
document.addEventListener('click',()=>closeCtx());
function showCtx(e,items){
  e.preventDefault();e.stopPropagation();closeCtx();
  const menu=document.getElementById('ctx-menu');
  items.forEach(item=>{
    if(item==='sep'){const sep=document.createElement('div');sep.className='ctx-sep';menu.appendChild(sep);return;}
    const el=document.createElement('div');el.className='ctx-item'+(item.danger?' danger':'');
    el.innerHTML=(item.icon||'')+' '+esc(item.label);
    el.addEventListener('click',()=>{closeCtx();item.action();});
    menu.appendChild(el);
  });
  menu.style.display='block';
  const mw=menu.offsetWidth,mh=menu.offsetHeight;
  let x=e.clientX,y=e.clientY;
  if(x+mw>window.innerWidth)x=window.innerWidth-mw-8;
  if(y+mh>window.innerHeight)y=window.innerHeight-mh-8;
  menu.style.left=x+'px';menu.style.top=y+'px';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderSidebar(){
  mode==='hw'?renderHWSidebar():renderExamSidebar();
}
function _buildSubjects(isExam){
  const list=document.getElementById('matkul-list');list.innerHTML='';
  subjects.forEach((s,si)=>{
    const row=document.createElement('div');row.className='matkul-row';
    const hdr=document.createElement('button');hdr.className='matkul-hdr'+(s.open?' open':'');
    const count = isExam?(s.exams||[]).length:(s.assignments||[]).length;
    hdr.innerHTML=`<span class="matkul-chev">â–¶</span><span class="matkul-icon">${s.icon}</span><span class="matkul-name">${esc(s.name)}</span><span class="matkul-cnt">${count} ${isExam?'exams':'tasks'}</span>`;
    const acts=document.createElement('div');acts.className='matkul-acts';
    const addA=document.createElement('button');addA.className='matkul-act';addA.title='add';addA.textContent='ï¼‹';
    addA.addEventListener('click',e=>{e.stopPropagation();isExam?openEFModal(s.id):openHWModal(s.id);});
    const delA=document.createElement('button');delA.className='matkul-act';delA.title='delete subject';delA.textContent='ğŸ—‘';
    delA.addEventListener('click',e=>{e.stopPropagation();askDelete('delete this subject? ğŸ¥º',`<strong>"${esc(s.name)}"</strong> will be gone forever~`,()=>{subjects.splice(si,1);if(activeSid===s.id){activeSid=null;activeAid=null;}if(activeESid===s.id){activeESid=null;activeEFid=null;}save();renderSidebar();renderEmpty();});});
    acts.append(addA,delA);
    if(!isExam){
      const gd=document.createElement('button');gd.className='gdrive-btn'+(s.driveLink?' has-link':'');gd.title='drive folder';gd.textContent='ğŸ“';
      gd.addEventListener('click',e=>{e.stopPropagation();if(s.driveLink){const a=document.createElement('a');a.href=s.driveLink;a.target='_blank';a.click();}else{const u=prompt('Drive folder link~');if(u&&u.trim()){s.driveLink=u.trim();save();renderSidebar();}}});
      gd.addEventListener('contextmenu',e=>{e.preventDefault();e.stopPropagation();const u=prompt('Update drive link~',s.driveLink||'');if(u!==null){s.driveLink=u.trim()||null;save();renderSidebar();}});
      hdr.appendChild(gd);
    }
    hdr.appendChild(acts);
    hdr.addEventListener('click',()=>{s.open=!s.open;save();renderSidebar();});
    row.appendChild(hdr);
    if(s.open){
      const subL=document.createElement('div');subL.className='subfolder-list';
      const items=isExam?(s.exams||[]):(s.assignments||[]);
      items.forEach((item,ii)=>{
        const btn=document.createElement('button');btn.className='sfbtn';
        const isActiveHW = !isExam&&activeSid===s.id&&activeAid===item.id;
        const isActiveExam= isExam&&activeESid===s.id&&activeEFid===item.id;
        if(isActiveHW||isActiveExam)btn.classList.add('active');
        if(!isExam&&item.pinned)btn.classList.add('pinned-f');
        btn.innerHTML=`<span class="sf-icon">${item.icon}</span>`;
        const nameEl=document.createElement('span');nameEl.className='sf-name';nameEl.textContent=item.name;btn.appendChild(nameEl);
        if(item.name.length>15){const tip=document.createElement('span');tip.className='sf-tooltip';tip.textContent=item.name;btn.appendChild(tip);}
        if(isExam){
          const tc=typeClass(item.examType);
          const badge=document.createElement('span');badge.className=`exam-type-mini ${tc}`;badge.textContent=EXAM_TYPES[item.examType]||item.examType;btn.appendChild(badge);
        } else {
          const dot=document.createElement('span');dot.className='sb-status-dot '+(item.status||'untouched');btn.appendChild(dot);
        }
        if(!isExam&&item.pinned){const pb=document.createElement('span');pb.className='sf-icon';pb.textContent='ğŸ“Œ';btn.insertBefore(pb,btn.querySelector('.sf-icon').nextSibling);}
        const del=document.createElement('button');del.className='sf-del';del.textContent='ğŸ—‘';
        del.addEventListener('click',e=>{e.stopPropagation();
          askDelete(`delete? ğŸ¥º`,`<strong>"${esc(item.name)}"</strong> will be gone~`,()=>{
            items.splice(ii,1);
            if(!isExam&&activeAid===item.id)activeAid=null;
            if(isExam&&activeEFid===item.id)activeEFid=null;
            save();renderSidebar();renderEmpty();
          });
        });
        btn.appendChild(del);
        btn.addEventListener('click',()=>{
          if(isExam){activeESid=s.id;activeEFid=item.id;renderSidebar();renderExam();}
          else{activeSid=s.id;activeAid=item.id;renderSidebar();renderHW();}
        });
        if(isExam){
          btn.addEventListener('contextmenu',e=>{showCtx(e,[
            {icon:'ğŸ“‹',label:'Duplicate',action:()=>dupEF(s.id,item.id)},
            {icon:'ğŸ“‚',label:'Move to...',action:()=>openMoveModal('exam',s.id,item.id)},
            {icon:'ğŸ—“ï¸',label:'Add to schedule',action:()=>{openEVModal(item.id);}},
            'sep',
            {icon:'ğŸ—‘',label:'Delete',danger:true,action:()=>askDelete('delete? ğŸ¥º',`<strong>"${esc(item.name)}"</strong>`,()=>{items.splice(ii,1);if(activeEFid===item.id)activeEFid=null;save();renderSidebar();renderEmpty();})}
          ]);});
        } else {
          btn.addEventListener('contextmenu',e=>{showCtx(e,[
            {icon:'ğŸ“‹',label:'Duplicate',action:()=>dupHW(s.id,item.id)},
            {icon:'ğŸ“‚',label:'Move to...',action:()=>openMoveModal('hw',s.id,item.id)},
            {icon:'ğŸ“Œ',label:item.pinned?'Unpin':'Pin to top',action:()=>{item.pinned=!item.pinned;save();renderSidebar();}},
            'sep',
            {icon:'ğŸ—‘',label:'Delete',danger:true,action:()=>askDelete('delete? ğŸ¥º',`<strong>"${esc(item.name)}"</strong>`,()=>{items.splice(ii,1);if(activeAid===item.id)activeAid=null;save();renderSidebar();renderEmpty();})}
          ]);});
        }
        subL.appendChild(btn);
      });
      const addSub=document.createElement('button');addSub.className='add-sf-btn';
      addSub.textContent=isExam?'ï¼‹ new exam folder':'ï¼‹ new assignment';
      addSub.addEventListener('click',()=>isExam?openEFModal(s.id):openHWModal(s.id));
      subL.appendChild(addSub);
      row.appendChild(subL);
    }
    list.appendChild(row);
  });
}
function renderHWSidebar(){
  const pw=document.getElementById('pinned-wrap');
  const pinned=[];
  subjects.forEach(s=>(s.assignments||[]).forEach(a=>{if(a.pinned)pinned.push({s,a});}));
  if(pinned.length){
    pw.innerHTML=`<div class="pinned-strip"><div class="pinned-strip-label">ğŸ“Œ pinned</div>${
      pinned.map(({s,a})=>`<button class="pinned-item" onclick="jumpHW('${s.id}','${a.id}')"><span>ğŸ“Œ</span><span class="pinned-item-name">${esc(a.icon)} ${esc(a.name)}</span><span class="pinned-item-sub">${esc(s.name)}</span></button>`).join('')
    }</div>`;
  } else pw.innerHTML='';
  _buildSubjects(false);
}
function renderExamSidebar(){
  document.getElementById('pinned-wrap').innerHTML='';
  _buildSubjects(true);
}
function jumpHW(sid,aid){
  mode='hw';activeSid=sid;activeAid=aid;applyMode();
  const s=getSub(sid);if(s)s.open=true;
  renderSidebar();renderHW();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HW PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderHW(){
  const main=document.getElementById('main-content');
  const subj=getSub(activeSid),asgn=subj?getHW(activeSid,activeAid):null;
  if(!asgn){renderEmpty();return;}
  if(!asgn.status)asgn.status='untouched';
  const done=(asgn.tasks||[]).filter(t=>t.done).length,total=(asgn.tasks||[]).length;
  const pct=total?Math.round(done/total*100):0;
  const overdue=asgn.dueDate&&new Date(asgn.dueDate+'T'+(asgn.dueTime||'23:59'))<new Date();
  const sbHtml=STATUSES.map(st=>`<button class="sbtn ${asgn.status===st.k?st.ac:''}" data-status="${st.k}"><span class="sdot" style="background:${st.d}"></span>${st.l}</button>`).join('');
  const isSubmitted=!!asgn.submitted;

  const page=document.createElement('div');page.className='memo-page';
  page.innerHTML=`
  <div class="crumb"><span class="cs">${esc(subj.icon)} ${esc(subj.name)}</span><span class="sep">â€º</span><span class="ct">${esc(asgn.icon)} ${esc(asgn.name)}</span></div>
  <div class="memo-hdr">
    <span class="memo-icon">${asgn.icon}</span>
    <div class="memo-fields">
      <input class="memo-title" value="${esc(asgn.name)}" placeholder="assignment title..." id="hw-title-inp"/>
      <div class="status-strip"><span class="sl">status :</span>${sbHtml}</div>
      <div class="date-row">
        <div class="df">
          <span class="dfl">start :</span>
          <div class="start-pill">
            <button type="button" class="date-trigger-btn" id="hw-start-btn">
              <span class="cal-icon">ğŸ“…</span>
              <span id="hw-start-lbl">${asgn.startDate||'pick date'}</span>
            </button>
            <button class="today-btn" id="hw-today">today</button>
          </div>
        </div>
        <div class="df">
          <span class="dfl dead">DEADLINE !</span>
          <div class="deadline-pill ${overdue?'overdue':''}">
            <button type="button" class="date-trigger-btn" id="hw-dl-btn" style="border:none;padding:.2rem .5rem;background:transparent;">
              <span class="cal-icon">ğŸ—“ï¸</span>
              <span id="hw-dl-lbl" style="color:#c0392b;font-weight:700;">${asgn.dueDate||'pick date'}${asgn.dueTime?' '+asgn.dueTime:''}</span>
            </button>
            ${(asgn.dueDate||asgn.dueTime)?'<button class="dl-clear" id="hw-dl-clear">âœ•</button>':''}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card" style="margin-bottom:1.3rem">
    <div class="card-hdr">
      <span class="card-label">ğŸ“¬ submission</span>
      <button class="submit-toggle ${isSubmitted?'on':''}" id="hw-submit-btn"><span>${isSubmitted?'âœ…':'â¬œ'}</span>${isSubmitted?'Submitted!':'Mark as Submitted'}</button>
    </div>
    <div class="link-row">
      <span class="link-label">ğŸ”— submit to :</span>
      <div class="link-wrap"><input type="url" class="link-inp" id="hw-submit-link" placeholder="paste submission link..." value="${esc(asgn.submitLink||'')}"/><button class="open-btn" id="hw-submit-open">open â†—</button></div>
    </div>
  </div>

  <div class="card" style="margin-bottom:1.3rem">
    <div class="two-col">
      <div>
        <div class="col-hdr"><span class="card-label">ğŸ“ materials</span><div class="col-btns"><button class="add-chip-btn" id="mat-file-btn">ï¼‹ file</button><button class="add-chip-btn blue" id="mat-link-btn">ï¼‹ link</button></div></div>
        <div class="chips-wrap" id="mat-chips"></div>
        <div id="mat-link-row" style="display:none" class="add-link-row"><input class="add-link-inp" id="mat-link-inp" type="url" placeholder="paste url..."/><button class="add-link-ok" id="mat-link-ok">add</button></div>
        <input type="file" id="mat-file-inp" style="display:none" multiple accept="image/*,.pdf,.doc,.docx,.pptx,.xlsx,.txt"/>
      </div>
      <div class="col-div"></div>
      <div>
        <div class="col-hdr"><span class="card-label">ğŸ“‹ question files</span><div class="col-btns"><button class="add-chip-btn" id="qf-file-btn">ï¼‹ file</button><button class="add-chip-btn blue" id="qf-link-btn">ï¼‹ link</button></div></div>
        <div class="chips-wrap" id="qf-chips"></div>
        <div id="qf-link-row" style="display:none" class="add-link-row"><input class="add-link-inp" id="qf-link-inp" type="url" placeholder="paste url..."/><button class="add-link-ok" id="qf-link-ok">add</button></div>
        <input type="file" id="qf-file-inp" style="display:none" multiple accept="image/*,.pdf,.doc,.docx,.pptx,.xlsx,.txt"/>
      </div>
    </div>
  </div>

  <div class="card" style="margin-bottom:1.3rem">
    <span class="card-label">ğŸ—’ï¸ notes</span>
    <textarea class="notes-ta" id="hw-notes" placeholder="write notes for this assignment...">${esc(asgn.notes||'')}</textarea>
  </div>

  <div class="task-lbl">âœ¦ task checklist</div>
  <div class="task-list" id="task-list"></div>
  <div class="add-task-row" id="add-task-row"><span>ï¼‹</span> add task</div>

  <div class="progress-section">
    <div class="progress-row"><span class="progress-text">progress</span><span class="progress-pct">${done}/${total} (${pct}%)</span></div>
    <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
  </div>

  <div class="card" style="margin-bottom:1.3rem;margin-top:1.3rem">
    <div class="card-hdr">
      <span class="card-label">ğŸ—‚ï¸ assignment files</span>
      <div class="folder-attach-btns">
        <button class="add-chip-btn" id="fa-file-btn">ğŸ“ upload</button>
        <button class="add-chip-btn" id="fa-photo-btn">ğŸ–¼ï¸ photo</button>
        <button class="add-chip-btn blue" id="fa-link-btn">ğŸ”— link</button>
      </div>
    </div>
    <div class="chips-wrap" id="fa-chips"></div>
    <div id="fa-link-row" style="display:none" class="add-link-row"><input class="add-link-inp" id="fa-link-inp" type="url" placeholder="paste url..."/><button class="add-link-ok" id="fa-link-ok">add</button></div>
    <input type="file" id="fa-file-inp" style="display:none" multiple accept=".pdf,.doc,.docx,.pptx,.xlsx,.txt,.zip"/>
    <input type="file" id="fa-photo-inp" style="display:none" multiple accept="image/*"/>
  </div>`;

  _bindHW(page,subj,asgn);
  main.innerHTML='';main.appendChild(page);
  _renderChips('mat-chips',asgn.materialFiles||[],asgn.materialLinks||[],i=>{asgn.materialFiles.splice(i,1);save();_renderChips('mat-chips',asgn.materialFiles,asgn.materialLinks||[],null,null);},i=>{asgn.materialLinks.splice(i,1);save();_renderChips('mat-chips',asgn.materialFiles||[],asgn.materialLinks,null,null);});
  _renderChips('qf-chips',asgn.questionFiles||[],asgn.questionLinks||[],i=>{asgn.questionFiles.splice(i,1);save();_renderChips('qf-chips',asgn.questionFiles,asgn.questionLinks||[],null,null);},i=>{asgn.questionLinks.splice(i,1);save();_renderChips('qf-chips',asgn.questionFiles||[],asgn.questionLinks,null,null);});
  _renderFAChips(asgn);
  renderTasks(asgn);
}

function _bindHW(page,subj,asgn){
  page.querySelector('#hw-title-inp').addEventListener('change',function(){asgn.name=this.value;save();renderSidebar();});
  page.querySelectorAll('.sbtn').forEach(b=>b.addEventListener('click',()=>{asgn.status=b.dataset.status;save();renderSidebar();renderHW();}));
  page.querySelector('#hw-submit-btn').addEventListener('click',()=>{asgn.submitted=!asgn.submitted;if(asgn.submitted)asgn.status='submitted';save();renderSidebar();renderHW();});
  page.querySelector('#hw-submit-link').addEventListener('change',function(){asgn.submitLink=this.value.trim();save();});
  page.querySelector('#hw-submit-open').addEventListener('click',()=>{const u=page.querySelector('#hw-submit-link').value.trim();if(u)open(u,'_blank');});
  // Coquette start date picker
  page.querySelector('#hw-start-btn').addEventListener('click',()=>{
    openCQPicker({date:asgn.startDate,showTime:false,title:'ğŸŒ¸ start date',callback:(d)=>{
      asgn.startDate=d;save();
      const lbl=page.querySelector('#hw-start-lbl');if(lbl)lbl.textContent=d;
    }});
  });
  page.querySelector('#hw-today').addEventListener('click',()=>{
    asgn.startDate=iso();save();
    const lbl=page.querySelector('#hw-start-lbl');if(lbl)lbl.textContent=iso();
  });
  // Coquette deadline picker (date + time)
  page.querySelector('#hw-dl-btn').addEventListener('click',()=>{
    openCQPicker({date:asgn.dueDate,time:asgn.dueTime,showTime:true,title:'ğŸ—“ï¸ deadline',callback:(d,t)=>{
      asgn.dueDate=d;asgn.dueTime=t||null;save();renderHW();
    }});
  });
  const dlc=page.querySelector('#hw-dl-clear');if(dlc)dlc.addEventListener('click',()=>askDelete('clear deadline? ğŸ¥º','',()=>{asgn.dueDate=null;asgn.dueTime=null;save();renderHW();}));
  _bindFileChip(page,'#mat-file-btn','#mat-file-inp','#mat-link-btn','#mat-link-row','#mat-link-inp','#mat-link-ok',asgn,'materialFiles','materialLinks','mat-chips');
  _bindFileChip(page,'#qf-file-btn','#qf-file-inp','#qf-link-btn','#qf-link-row','#qf-link-inp','#qf-link-ok',asgn,'questionFiles','questionLinks','qf-chips');
  const fafi=page.querySelector('#fa-file-inp'),fapi=page.querySelector('#fa-photo-inp');
  page.querySelector('#fa-file-btn').addEventListener('click',()=>fafi.click());
  page.querySelector('#fa-photo-btn').addEventListener('click',()=>fapi.click());
  [fafi,fapi].forEach(inp=>inp.addEventListener('change',function(){Array.from(this.files).forEach(f=>{const r=new FileReader();r.onload=e=>{if(!asgn.folderAttachments)asgn.folderAttachments=[];asgn.folderAttachments.push({name:f.name,data:e.target.result,type:f.type});save();_renderFAChips(asgn);};r.readAsDataURL(f);});this.value='';}));
  const falr=page.querySelector('#fa-link-row'),fali=page.querySelector('#fa-link-inp');
  page.querySelector('#fa-link-btn').addEventListener('click',()=>{falr.style.display=falr.style.display==='none'?'flex':'none';if(falr.style.display==='flex')setTimeout(()=>fali.focus(),40);});
  const commitFA=()=>{const u=fali.value.trim();if(!u)return;if(!asgn.folderLinks)asgn.folderLinks=[];asgn.folderLinks.push(u);save();_renderFAChips(asgn);fali.value='';falr.style.display='none';};
  page.querySelector('#fa-link-ok').addEventListener('click',commitFA);
  fali.addEventListener('keydown',e=>{if(e.key==='Enter')commitFA();});
  page.querySelector('#add-task-row').addEventListener('click',addTask);
  page.querySelector('#hw-notes').addEventListener('input',function(){asgn.notes=this.value;save();});
}

function _bindFileChip(page,fileBtnSel,fileInpSel,linkBtnSel,linkRowSel,linkInpSel,linkOkSel,asgn,fileKey,linkKey,chipsId){
  const fi=page.querySelector(fileInpSel);
  page.querySelector(fileBtnSel).addEventListener('click',()=>fi.click());
  fi.addEventListener('change',function(){Array.from(this.files).forEach(f=>{const r=new FileReader();r.onload=e=>{if(!asgn[fileKey])asgn[fileKey]=[];asgn[fileKey].push({name:f.name,data:e.target.result,type:f.type});save();_renderChips(chipsId,asgn[fileKey]||[],asgn[linkKey]||[],i=>{asgn[fileKey].splice(i,1);save();_renderChips(chipsId,asgn[fileKey],asgn[linkKey]||[],null,null);},i=>{asgn[linkKey].splice(i,1);save();_renderChips(chipsId,asgn[fileKey]||[],asgn[linkKey],null,null);});};r.readAsDataURL(f);});this.value='';});
  const lr=page.querySelector(linkRowSel),li=page.querySelector(linkInpSel);
  page.querySelector(linkBtnSel).addEventListener('click',()=>{lr.style.display=lr.style.display==='none'?'flex':'none';if(lr.style.display==='flex')setTimeout(()=>li.focus(),40);});
  const commit=()=>{const u=li.value.trim();if(!u)return;if(!asgn[linkKey])asgn[linkKey]=[];asgn[linkKey].push(u);save();_renderChips(chipsId,asgn[fileKey]||[],asgn[linkKey],i=>{asgn[fileKey].splice(i,1);save();_renderChips(chipsId,asgn[fileKey],asgn[linkKey]||[],null,null);},i=>{asgn[linkKey].splice(i,1);save();_renderChips(chipsId,asgn[fileKey]||[],asgn[linkKey],null,null);});li.value='';lr.style.display='none';};
  page.querySelector(linkOkSel).addEventListener('click',commit);
  li.addEventListener('keydown',e=>{if(e.key==='Enter')commit();});
}

function _renderChips(cid,files,links,onFileDel,onLinkDel){
  const c=document.getElementById(cid);if(!c)return;c.innerHTML='';
  if(!files.length&&!links.length){c.innerHTML='<span class="chip-empty">nothing yet~</span>';return;}
  files.forEach((f,i)=>{const img=f.type&&f.type.startsWith('image/');const chip=document.createElement('div');chip.className='file-chip';chip.title='click to open';chip.innerHTML=`<span>${img?'ğŸ–¼ï¸':fileIcon(f.name)}</span><span class="chip-name">${esc(f.name)}</span><button class="chip-del">âœ•</button>`;chip.addEventListener('click',e=>{if(e.target.classList.contains('chip-del'))return;img?openLightbox(f.data):dlFile(f);});chip.querySelector('.chip-del').addEventListener('click',e=>{e.stopPropagation();if(onFileDel)askDelete('delete file?',`<strong>"${esc(f.name)}"</strong>`,()=>onFileDel(i));});c.appendChild(chip);});
  links.forEach((l,i)=>{const label=l.replace(/^https?:\/\//,'').split('/')[0]||l;const chip=document.createElement('div');chip.className='link-chip';chip.title=l;chip.innerHTML=`<span>ğŸ”—</span><span class="link-chip-name">${esc(label)}</span><button class="link-chip-del">âœ•</button>`;chip.querySelector('.link-chip-name').addEventListener('click',()=>window.open(l,'_blank'));chip.querySelector('.link-chip-del').addEventListener('click',e=>{e.stopPropagation();if(onLinkDel)askDelete('delete link?','',()=>onLinkDel(i));});c.appendChild(chip);});
}

function _renderFAChips(asgn){
  _renderChips('fa-chips',asgn.folderAttachments||[],asgn.folderLinks||[],i=>{asgn.folderAttachments.splice(i,1);save();_renderFAChips(asgn);},i=>{asgn.folderLinks.splice(i,1);save();_renderFAChips(asgn);});
}

function dlFile(f){const a=document.createElement('a');a.href=f.data;a.download=f.name;a.click();}
function fileIcon(n){const e=n.split('.').pop().toLowerCase();return{pdf:'ğŸ“„',doc:'ğŸ“',docx:'ğŸ“',pptx:'ğŸ“Š',ppt:'ğŸ“Š',xlsx:'ğŸ“‹',xls:'ğŸ“‹'}[e]||'ğŸ“';}

/* â”€â”€ Tasks â”€â”€ */
function renderTasks(asgn){
  const list=document.getElementById('task-list');if(!list)return;list.innerHTML='';
  (asgn.tasks||[]).forEach((t,i)=>{
    const card=document.createElement('div');card.className='task-card';
    const mainRow=document.createElement('div');mainRow.className='task-main';
    const chk=document.createElement('div');chk.className='task-chk'+(t.done?' done':'');chk.innerHTML=t.done?'âœ“':'';
    chk.addEventListener('click',()=>{t.done=!t.done;save();renderHW();renderSidebar();});
    const num=document.createElement('span');num.className='task-num';num.textContent=t.number+'.';
    const inp=document.createElement('input');inp.className='task-inp'+(t.done?' done':'');inp.value=t.label||'';inp.placeholder=`task no. ${t.number}...`;
    inp.addEventListener('change',function(){t.label=this.value;save();renderSidebar();});
    const hasA=(t.links&&t.links.length)||(t.photos&&t.photos.length);
    const exp=document.createElement('button');exp.className='task-exp';exp.textContent=hasA?'ğŸ”—ğŸ“':'+ answers';
    exp.addEventListener('click',()=>{const p=card.querySelector('.task-attach');p.classList.toggle('open');exp.textContent=p.classList.contains('open')?'â–² close':(hasA?'ğŸ”—ğŸ“':'+ answers');});
    const del=document.createElement('button');del.className='task-del';del.textContent='ğŸ—‘';
    del.addEventListener('click',()=>{const lbl=t.label||'no.'+t.number;askDelete('delete task? ğŸ¥º',`<strong>"${esc(lbl)}"</strong>`,()=>{asgn.tasks.splice(i,1);asgn.tasks.forEach((tt,idx)=>tt.number=idx+1);save();renderHW();renderSidebar();});});
    mainRow.append(chk,num,inp,exp,del);
    const panel=document.createElement('div');panel.className='task-attach';panel.innerHTML=_buildAttach(t,i);_bindAttach(panel,i,asgn);
    card.append(mainRow,panel);list.appendChild(card);
  });
}
function addTask(){
  const asgn=getHW(activeSid,activeAid);if(!asgn)return;
  const maxN=asgn.tasks.length?Math.max(...asgn.tasks.map(t=>t.number)):0;
  asgn.tasks.push({number:maxN+1,label:'',done:false,links:[],photos:[]});
  save();renderHW();renderSidebar();
  setTimeout(()=>{const ins=document.querySelectorAll('.task-inp');if(ins.length)ins[ins.length-1].focus();},60);
}
function _buildAttach(t,i){
  const links=t.links||[];
  let h=links.map((l,li)=>`<div class="attach-row"><span class="attach-lbl">ğŸ”— link</span><div class="link-inp-wrap"><input class="ta-inp" type="url" value="${esc(l)}" data-li="${li}"/><button class="ta-open" data-lo="${li}">open â†—</button><button class="chip-del" data-ld="${li}">âœ•</button></div></div>`).join('');
  h+=`<div class="attach-row"><span class="attach-lbl"></span><button class="add-chip-btn" data-al="${i}" style="margin:0">ï¼‹ add link</button></div>`;
  const photos=t.photos||[];
  h+=`<div class="attach-row" style="align-items:flex-start"><span class="attach-lbl" style="padding-top:6px">ğŸ“¸ photo</span><div class="photo-chips" id="pchips-${i}">`;
  photos.forEach((p,pi)=>{h+=`<div class="photo-chip"><img src="${p}" alt=""/><button class="photo-chip-del" data-pd="${pi}">âœ•</button></div>`;});
  h+=`<label class="photo-add"><span style="pointer-events:none">ğŸ“·</span><input type="file" accept="image/*" multiple data-pu="${i}"/></label></div></div>`;
  return h;
}
function _bindAttach(panel,i,asgn){
  panel.querySelectorAll('.ta-inp').forEach(inp=>inp.addEventListener('change',function(){asgn.tasks[i].links[parseInt(this.dataset.li)]=this.value.trim();save();}));
  panel.querySelectorAll('[data-lo]').forEach(b=>b.addEventListener('click',()=>{const u=(asgn.tasks[i].links||[])[parseInt(b.dataset.lo)];if(u)window.open(u,'_blank');}));
  panel.querySelectorAll('[data-ld]').forEach(b=>b.addEventListener('click',()=>askDelete('delete link?','',()=>{asgn.tasks[i].links.splice(parseInt(b.dataset.ld),1);save();renderHW();})));
  panel.querySelectorAll('[data-al]').forEach(b=>b.addEventListener('click',()=>{if(!asgn.tasks[i].links)asgn.tasks[i].links=[];asgn.tasks[i].links.push('');save();renderHW();setTimeout(()=>{const cards=document.querySelectorAll('.task-card');if(cards[i]){const p=cards[i].querySelector('.task-attach');if(p)p.classList.add('open');}},60);}));
  panel.querySelectorAll('.photo-chip img').forEach(img=>img.addEventListener('click',()=>openLightbox(img.src)));
  panel.querySelectorAll('[data-pd]').forEach(b=>b.addEventListener('click',e=>{e.stopPropagation();askDelete('delete photo?','',()=>{asgn.tasks[i].photos.splice(parseInt(b.dataset.pd),1);save();renderHW();});}));
  panel.querySelectorAll('[data-pu]').forEach(inp=>inp.addEventListener('change',function(){const fs=Array.from(this.files);let done=0;fs.forEach(f=>{const r=new FileReader();r.onload=e=>{if(!asgn.tasks[i].photos)asgn.tasks[i].photos=[];asgn.tasks[i].photos.push(e.target.result);if(++done===fs.length){save();renderHW();}};r.readAsDataURL(f);});this.value='';}));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXAM PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderExam(){
  clearInterval(_cdInt);
  const main=document.getElementById('main-content');
  const s=getSub(activeESid),f=s?getEF(activeESid,activeEFid):null;
  if(!f){renderEmpty();return;}
  const tc=typeClass(f.examType),tn=EXAM_TYPES[f.examType]||f.examType;
  const done=(f.materiList||[]).filter(m=>m.done).length,total=(f.materiList||[]).length;
  const pct=total?Math.round(done/total*100):0;

  // Check if there's a calendar event synced
  const calEv = examEvents.find(ev=>ev.folderId===f.id);
  // Use folder date OR calendar event date (folder is source of truth after sync)
  const displayDate = f.examDate || (calEv?.date) || null;
  const displayTime = f.examTime || (calEv?.time) || null;
  const displayRoom = f.examRoom || (calEv?.room) || '';

  const cdHtml=displayDate?`
    <div class="cd-timer">
      <div class="cd-unit"><span class="cd-num" id="cd-d">--</span><span class="cd-unit-lbl">days</span></div>
      <span class="cd-sep">:</span>
      <div class="cd-unit"><span class="cd-num" id="cd-h">--</span><span class="cd-unit-lbl">hrs</span></div>
      <span class="cd-sep">:</span>
      <div class="cd-unit"><span class="cd-num" id="cd-m">--</span><span class="cd-unit-lbl">min</span></div>
      <span class="cd-sep">:</span>
      <div class="cd-unit"><span class="cd-num" id="cd-s">--</span><span class="cd-unit-lbl">sec</span></div>
    </div>`:`<div style="font-size:.83rem;opacity:.7;margin:.3rem 0">set exam date to start countdown~</div>`;

  const matHtml=(f.materiList||[]).map((m,i)=>`
    <div class="materi-item" id="mi-${i}">
      <div class="materi-main">
        <div class="materi-chk ${m.done?'done':''}" data-mi="${i}">${m.done?'âœ“':''}</div>
        <input class="materi-name-inp ${m.done?'done':''}" value="${esc(m.name||'')}" placeholder="materi name..." data-mn="${i}"/>
        <div class="materi-btns">
          ${(m.links&&m.links.length)||(m.files&&m.files.length)?'<span style="font-size:.65rem;color:#b899e0">ğŸ“</span>':''}
          <button class="materi-att-btn" data-mlink="${i}">ğŸ”— link</button>
          <label class="materi-att-btn" style="cursor:pointer;display:flex;align-items:center">ğŸ“ file<input type="file" data-mfile="${i}" style="display:none" accept="image/*,.pdf,.doc,.docx,.pptx"/></label>
          <button class="materi-del" data-mdel="${i}">ğŸ—‘</button>
        </div>
      </div>
      <div class="materi-attachments ${(m.links&&m.links.length)||(m.files&&m.files.length)?'open':''}" id="ma-${i}">
        ${(m.links||[]).map((l,li)=>`<div class="link-chip"><span>ğŸ”—</span><span class="link-chip-name" data-open="${l}">${esc(l.replace(/^https?:\/\//,'').split('/')[0]||l)}</span><button class="link-chip-del" data-dml="${i}-${li}">âœ•</button></div>`).join('')}
        ${(m.files||[]).map((fl,fi)=>`<div class="file-chip" style="background:linear-gradient(135deg,#f3eeff,#e8dcf8)"><span>${fileIcon(fl.name)}</span><span class="chip-name">${esc(fl.name)}</span><button class="chip-del" data-dmf="${i}-${fi}">âœ•</button></div>`).join('')}
      </div>
    </div>`).join('');

  const page=document.createElement('div');page.className='exam-page';
  page.innerHTML=`
  <div class="crumb exam-crumb"><span class="cs">${esc(s.icon)} ${esc(s.name)}</span><span class="sep">â€º</span><span class="ct">${f.icon} ${esc(f.name)}</span></div>
  <div class="exam-hdr">
    <div class="exam-hdr-left">
      <div class="exam-title-row">
        <span class="exam-type-badge ${tc}">${tn}</span>
        <input class="exam-title-inp" value="${esc(f.name)}" placeholder="exam name..." id="ef-title"/>
      </div>
      ${displayRoom?`<div style="font-size:.75rem;color:#9a7ac8;font-weight:600;margin-top:.2rem">ğŸ“ ${esc(displayRoom)}</div>`:''}
    </div>
    <div class="countdown-box ${displayDate?'':'no-date'}">
      <div class="cd-label">â³ exam countdown</div>
      ${cdHtml}
      <div class="exam-when-row">
        <span class="exam-when-lbl">ğŸ“…</span>
        <button type="button" class="exam-inp" id="ef-date-btn" style="cursor:pointer;font-size:.73rem;font-weight:700;">${displayDate||'pick date'}</button>
        <span class="exam-when-lbl">â°</span>
        <button type="button" class="exam-inp" id="ef-time-btn" style="cursor:pointer;font-size:.73rem;font-weight:700;">${displayTime||'pick time'}</button>
        <span class="exam-when-lbl">ğŸ“</span><input class="exam-room-inp" id="ef-room" placeholder="room..." value="${esc(displayRoom)}"/>
      </div>
    </div>
  </div>

  <div class="exam-card">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.8rem">
      <span class="exam-card-label">ğŸ“Œ sources & collections</span>
    </div>
    <div class="sources-grid">
      <div class="source-item"><span class="source-lbl">ğŸ“— main source (book)</span><div class="source-field"><input class="source-url" type="url" id="src-main" placeholder="gdrive / link..." value="${esc(f.mainSource||'')}"/><button class="source-open" id="src-main-o">â†—</button></div></div>
      <div class="source-item"><span class="source-lbl">ğŸ“Š ppt slides</span><div class="source-field"><input class="source-url" type="url" id="src-ppt" placeholder="gdrive folder..." value="${esc(f.pptLink||'')}"/><button class="source-open" id="src-ppt-o">â†—</button></div></div>
      <div class="source-item"><span class="source-lbl">ğŸ“ exam collections</span><div class="source-field"><input class="source-url" type="url" id="src-ec" placeholder="past year papers..." value="${esc(f.examCollections||'')}"/><button class="source-open" id="src-ec-o">â†—</button></div></div>
    </div>
  </div>

  <div class="exam-card">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem">
      <span class="exam-card-label">ğŸ“ study materials checklist</span>
      <span style="font-size:.73rem;font-weight:700;color:#9b6fd4" id="materi-pct">${done}/${total} (${pct}%)</span>
    </div>
    <div class="materi-list" id="materi-list">${matHtml}</div>
    <div class="materi-progress"><div class="materi-pbar"><div class="materi-pfill" id="materi-fill" style="width:${pct}%"></div></div></div>
    <div class="add-materi-btn" id="add-materi"><span>ï¼‹</span> add materi</div>
  </div>

  <div class="exam-card">
    <span class="exam-card-label">ğŸ—’ï¸ notes</span>
    <textarea class="notes-ta exam-notes-ta" id="ef-notes" placeholder="catatan untuk ujian ini...">${esc(f.notes||'')}</textarea>
  </div>`;

  _bindExam(page,s,f);
  main.innerHTML='';main.appendChild(page);
  if(displayDate)_startCD({...f, examDate: displayDate, examTime: displayTime});
}

function _bindExam(page,s,f){
  page.querySelector('#ef-title').addEventListener('change',function(){f.name=this.value;save();renderSidebar();});

  // Coquette date picker for exam date
  page.querySelector('#ef-date-btn').addEventListener('click',()=>{
    openCQPicker({date:f.examDate,showTime:false,title:'ğŸ“… exam date',callback:(d)=>{
      f.examDate=d;_syncFolderToCalEvent(f);save();
      const btn=page.querySelector('#ef-date-btn');if(btn)btn.textContent=d;
      _startCD(f);
    }});
  });
  // Coquette time picker for exam time
  page.querySelector('#ef-time-btn').addEventListener('click',()=>{
    openCQPicker({date:f.examDate||iso(),time:f.examTime,showTime:true,title:'â° exam time',callback:(d,t)=>{
      f.examTime=t||null;_syncFolderToCalEvent(f);save();
      const btn=page.querySelector('#ef-time-btn');if(btn)btn.textContent=t||'pick time';
      _startCD(f);
    }});
  });
  page.querySelector('#ef-room').addEventListener('change',function(){
    f.examRoom=this.value.trim();
    _syncFolderToCalEvent(f);
    save();
  });

  // sources
  [['#src-main','#src-main-o','mainSource'],['#src-ppt','#src-ppt-o','pptLink'],['#src-ec','#src-ec-o','examCollections']].forEach(([inp,btn,key])=>{
    page.querySelector(inp).addEventListener('change',function(){f[key]=this.value.trim();save();});
    page.querySelector(btn).addEventListener('click',()=>{if(f[key])window.open(f[key],'_blank');});
  });
  // materi checklist
  page.querySelectorAll('[data-mi]').forEach(el=>el.addEventListener('click',()=>{
    const i=parseInt(el.dataset.mi);f.materiList[i].done=!f.materiList[i].done;save();
    el.innerHTML=f.materiList[i].done?'âœ“':'';el.classList.toggle('done',f.materiList[i].done);
    const ni=page.querySelector(`[data-mn="${i}"]`);if(ni)ni.classList.toggle('done',f.materiList[i].done);
    _updMatPct(f);
  }));
  page.querySelectorAll('[data-mn]').forEach(inp=>inp.addEventListener('change',function(){f.materiList[parseInt(this.dataset.mn)].name=this.value;save();}));
  page.querySelectorAll('[data-mlink]').forEach(btn=>btn.addEventListener('click',()=>{const i=parseInt(btn.dataset.mlink);const u=prompt('Paste link for this materi~');if(u&&u.trim()){if(!f.materiList[i].links)f.materiList[i].links=[];f.materiList[i].links.push(u.trim());save();renderExam();}}));
  page.querySelectorAll('[data-mfile]').forEach(inp=>inp.addEventListener('change',function(){const i=parseInt(this.dataset.mfile);Array.from(this.files).forEach(file=>{const r=new FileReader();r.onload=e=>{if(!f.materiList[i].files)f.materiList[i].files=[];f.materiList[i].files.push({name:file.name,data:e.target.result,type:file.type});save();renderExam();};r.readAsDataURL(file);});this.value='';}));
  page.querySelectorAll('[data-mdel]').forEach(btn=>btn.addEventListener('click',()=>askDelete('delete materi?','',()=>{f.materiList.splice(parseInt(btn.dataset.mdel),1);save();renderExam();})));
  page.querySelectorAll('[data-open]').forEach(el=>el.addEventListener('click',()=>window.open(el.dataset.open,'_blank')));
  page.querySelectorAll('[data-dml]').forEach(b=>b.addEventListener('click',e=>{e.stopPropagation();const[mi,li]=b.dataset.dml.split('-').map(Number);askDelete('remove link?','',()=>{f.materiList[mi].links.splice(li,1);save();renderExam();});}));
  page.querySelectorAll('[data-dmf]').forEach(b=>b.addEventListener('click',e=>{e.stopPropagation();const[mi,fi]=b.dataset.dmf.split('-').map(Number);askDelete('remove file?','',()=>{f.materiList[mi].files.splice(fi,1);save();renderExam();});}));
  page.querySelector('#add-materi').addEventListener('click',()=>{if(!f.materiList)f.materiList=[];f.materiList.push({name:'',done:false,links:[],files:[]});save();renderExam();setTimeout(()=>{const ins=document.querySelectorAll('.materi-name-inp');if(ins.length)ins[ins.length-1].focus();},60);});
  page.querySelector('#ef-notes').addEventListener('input',function(){f.notes=this.value;save();});
}

// Sync folder date/time/room to calendar event
function _syncFolderToCalEvent(f){
  if(!f.examDate) return;
  const existing = examEvents.findIndex(ev=>ev.folderId===f.id);
  const ev = {id: existing>=0 ? examEvents[existing].id : uid(), folderId:f.id, date:f.examDate, time:f.examTime||null, room:f.examRoom||''};
  if(existing>=0) examEvents[existing]=ev;
  else examEvents.push(ev);
}

function _updMatPct(f){
  const done=(f.materiList||[]).filter(m=>m.done).length,total=(f.materiList||[]).length;
  const pct=total?Math.round(done/total*100):0;
  const fill=document.getElementById('materi-fill');if(fill)fill.style.width=pct+'%';
  const lbl=document.getElementById('materi-pct');if(lbl)lbl.textContent=`${done}/${total} (${pct}%)`;
}

/* countdown */
function _startCD(f){
  clearInterval(_cdInt);_updCD(f);
  _cdInt=setInterval(()=>_updCD(f),1000);
}
function _updCD(f){
  if(!f||!f.examDate)return;
  const target=new Date(f.examDate+'T'+(f.examTime||'09:00')),now=new Date(),diff=target-now;
  const dd=document.getElementById('cd-d'),dh=document.getElementById('cd-h'),dm=document.getElementById('cd-m'),ds=document.getElementById('cd-s');
  if(!dd){clearInterval(_cdInt);return;}
  if(diff<=0){[dd,dh,dm,ds].forEach(el=>{if(el)el.textContent='00';});return;}
  const d=Math.floor(diff/86400000),h=Math.floor((diff%86400000)/3600000),m=Math.floor((diff%3600000)/60000),s=Math.floor((diff%60000)/1000);
  dd.textContent=String(d).padStart(2,'0');dh.textContent=String(h).padStart(2,'0');dm.textContent=String(m).padStart(2,'0');ds.textContent=String(s).padStart(2,'0');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALENDAR POPUP MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openCal(){
  document.getElementById('cal-modal-overlay').classList.remove('hidden');
  renderCalContent();
}
function closeCal(){document.getElementById('cal-modal-overlay').classList.add('hidden');}
document.getElementById('cal-modal-overlay').addEventListener('click',function(e){if(e.target===this)closeCal();});
document.getElementById('cal-prev').addEventListener('click',()=>{_calMonth=new Date(_calMonth.getFullYear(),_calMonth.getMonth()-1,1);renderCalContent();});
document.getElementById('cal-next').addEventListener('click',()=>{_calMonth=new Date(_calMonth.getFullYear(),_calMonth.getMonth()+1,1);renderCalContent();});
document.getElementById('add-ev-btn').addEventListener('click',()=>openEVModal());

// TODAY button in calendar
document.getElementById('cal-today-btn').addEventListener('click',()=>{
  _calMonth = new Date();
  renderCalContent();
});

function renderCalContent(){
  const yr=_calMonth.getFullYear(),mo=_calMonth.getMonth();
  const MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
  const DOWS=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const todayStr=iso();
  document.getElementById('cal-month-lbl').textContent=MONTHS[mo]+' '+yr;
  const grid=document.getElementById('cal-grid');grid.innerHTML='';
  DOWS.forEach(d=>{const el=document.createElement('div');el.className='cal-dow';el.textContent=d;grid.appendChild(el);});
  const firstDay=new Date(yr,mo,1).getDay(),dIM=new Date(yr,mo+1,0).getDate();
  for(let i=0;i<firstDay;i++){const prev=new Date(yr,mo,0-(firstDay-1-i));const el=document.createElement('div');el.className='cal-cell other-m';el.innerHTML=`<div class="cal-date-num">${prev.getDate()}</div>`;grid.appendChild(el);}
  for(let d=1;d<=dIM;d++){
    const ds=`${yr}-${String(mo+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const dayEvs=examEvents.filter(ev=>ev.date===ds);
    const isToday=ds===todayStr;
    const el=document.createElement('div');el.className='cal-cell'+(isToday?' today-c':'')+(dayEvs.length?' has-ev':'');
    el.dataset.date=ds;
    el.innerHTML=`<div class="cal-date-num">${d}</div>${dayEvs.map(ev=>{const r=findEF(ev.folderId);if(!r)return'';const tc=typeClass(r.f.examType);return`<div class="cal-ev ${tc}-ev" title="${esc(r.s.name)} â€” ${esc(r.f.name)}">${esc(r.f.name)}</div>`;}).join('')}`;
    el.addEventListener('click',e=>{if(e.target.classList.contains('cal-ev'))return;document.getElementById('ev-date').value=ds;openEVModal();});
    el.querySelectorAll('.cal-ev').forEach((evEl,eidx)=>{evEl.addEventListener('click',e=>{e.stopPropagation();const ev=dayEvs[eidx];if(!ev)return;const r=findEF(ev.folderId);if(!r)return;closeCal();activeESid=r.s.id;activeEFid=r.f.id;r.s.open=true;renderSidebar();renderExam();});});
    grid.appendChild(el);
  }
  const filled=firstDay+dIM,rem=(7-filled%7)%7;
  for(let i=1;i<=rem;i++){const el=document.createElement('div');el.className='cal-cell other-m';el.innerHTML=`<div class="cal-date-num">${i}</div>`;grid.appendChild(el);}

  // upcoming
  const now=new Date();
  const upcoming=examEvents.filter(ev=>new Date(ev.date+'T'+(ev.time||'23:59'))>=now).sort((a,b)=>new Date(a.date)-new Date(b.date));
  const upList=document.getElementById('upcoming-list');upList.innerHTML='';
  if(!upcoming.length){upList.innerHTML='<div class="no-upcoming">no upcoming exams~</div>';return;}
  upcoming.forEach((ev,idx)=>{
    const r=findEF(ev.folderId);if(!r)return;
    const dt=new Date(ev.date+'T'+(ev.time||'00:00'));
    const dLeft=Math.ceil((dt-now)/86400000);
    const MONS=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    const tc=typeClass(r.f.examType);
    const item=document.createElement('div');item.className='upcoming-item';
    item.innerHTML=`
      <div class="upcoming-date-box"><div class="udb-day">${String(dt.getDate()).padStart(2,'0')}</div><div class="udb-mon">${MONS[dt.getMonth()]}</div></div>
      <div class="upcoming-info">
        <div class="upcoming-name">${esc(r.s.icon)} ${esc(r.s.name)} â€” ${esc(r.f.name)}</div>
        <div class="upcoming-meta">
          <span class="exam-type-badge ${tc}" style="font-size:.58rem;padding:.04rem .45rem">${EXAM_TYPES[r.f.examType]||r.f.examType}</span>
          ${ev.time?`â° ${ev.time}`:''}
          ${ev.room?`ğŸ“ ${esc(ev.room)}`:''}
        </div>
      </div>
      <div class="upcoming-right"><div class="upcoming-days">${dLeft}</div><div class="upcoming-dl">days left</div></div>
      <button class="upcoming-del" data-idx="${idx}">ğŸ—‘</button>`;
    item.addEventListener('click',e=>{if(e.target.classList.contains('upcoming-del')||e.target.closest('.upcoming-del'))return;closeCal();activeESid=r.s.id;activeEFid=r.f.id;r.s.open=true;renderSidebar();renderExam();});
    item.querySelector('.upcoming-del').addEventListener('click',e=>{e.stopPropagation();askDelete('delete schedule?','',()=>{const gi=examEvents.findIndex(ev2=>ev2.id===ev.id);if(gi>=0)examEvents.splice(gi,1);save();renderCalContent();});});
    upList.appendChild(item);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CUSTOM COQUETTE DATE/TIME PICKER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _cqPickerMonth = new Date();
let _cqSelDate = null; // 'YYYY-MM-DD'
let _cqShowTime = false;
let _cqCallback = null; // fn(dateStr, timeStr|null)

function openCQPicker(opts){
  // opts: { date, time, showTime, callback, title }
  _cqShowTime = !!opts.showTime;
  _cqCallback = opts.callback;
  _cqSelDate = opts.date || null;
  document.querySelector('.cq-picker-title').textContent = opts.title || 'ğŸ€ pick a date';
  document.getElementById('cq-time-row').style.display = _cqShowTime ? 'flex' : 'none';
  if(opts.time){
    const [hr,mn] = opts.time.split(':');
    document.getElementById('cq-hr').value = hr||'';
    document.getElementById('cq-mn').value = mn||'';
  } else {
    document.getElementById('cq-hr').value = '';
    document.getElementById('cq-mn').value = '';
  }
  if(opts.date){
    _cqPickerMonth = new Date(opts.date+'T12:00:00');
  } else {
    _cqPickerMonth = new Date();
  }
  _renderCQCal();
  document.getElementById('cq-picker-overlay').classList.remove('hidden');
}

function closeCQPicker(){
  document.getElementById('cq-picker-overlay').classList.add('hidden');
}

function _renderCQCal(){
  const yr = _cqPickerMonth.getFullYear(), mo = _cqPickerMonth.getMonth();
  const MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
  const DOWS=['Su','Mo','Tu','We','Th','Fr','Sa'];
  const todayStr = iso();
  document.getElementById('cq-month-lbl').textContent = MONTHS[mo]+' '+yr;
  const grid = document.getElementById('cq-cal-grid'); grid.innerHTML='';
  DOWS.forEach(d=>{const el=document.createElement('div');el.className='cq-dow';el.textContent=d;grid.appendChild(el);});
  const firstDay=new Date(yr,mo,1).getDay(), dIM=new Date(yr,mo+1,0).getDate();
  for(let i=0;i<firstDay;i++){
    const prev=new Date(yr,mo,-(firstDay-1-i));
    const el=document.createElement('button');el.className='cq-day other-m';el.textContent=prev.getDate();el.type='button';
    grid.appendChild(el);
  }
  for(let d=1;d<=dIM;d++){
    const ds=`${yr}-${String(mo+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const el=document.createElement('button');el.type='button';
    el.className='cq-day'+(ds===todayStr?' today':'')+(ds===_cqSelDate?' selected':'');
    el.textContent=d;
    el.addEventListener('click',()=>{_cqSelDate=ds;_renderCQCal();});
    grid.appendChild(el);
  }
  const filled=firstDay+dIM,rem=(7-filled%7)%7;
  for(let i=1;i<=rem;i++){const el=document.createElement('button');el.className='cq-day other-m';el.textContent=i;el.type='button';grid.appendChild(el);}
}

document.getElementById('cq-prev').addEventListener('click',()=>{
  _cqPickerMonth=new Date(_cqPickerMonth.getFullYear(),_cqPickerMonth.getMonth()-1,1);_renderCQCal();
});
document.getElementById('cq-next').addEventListener('click',()=>{
  _cqPickerMonth=new Date(_cqPickerMonth.getFullYear(),_cqPickerMonth.getMonth()+1,1);_renderCQCal();
});
document.getElementById('cq-cancel').addEventListener('click',closeCQPicker);
document.getElementById('cq-picker-overlay').addEventListener('click',function(e){if(e.target===this)closeCQPicker();});
document.getElementById('cq-ok').addEventListener('click',()=>{
  if(!_cqSelDate){alert('please pick a date first~');return;}
  let timeStr = null;
  if(_cqShowTime){
    const hr=document.getElementById('cq-hr').value;
    const mn=document.getElementById('cq-mn').value;
    if(hr!==''&&mn!==''){
      timeStr=String(hr).padStart(2,'0')+':'+String(mn).padStart(2,'0');
    }
  }
  closeCQPicker();
  if(_cqCallback)_cqCallback(_cqSelDate,timeStr);
});


document.getElementById('sb-toggle').addEventListener('click',()=>document.getElementById('sidebar').classList.toggle('collapsed'));
const nightBtn=document.getElementById('night-btn');
if(localStorage.getItem('sha-night')==='1'){document.body.classList.add('night');nightBtn.textContent='â˜€ï¸';}
nightBtn.addEventListener('click',()=>{const on=document.body.classList.toggle('night');nightBtn.textContent=on?'â˜€ï¸':'ğŸŒ™';localStorage.setItem('sha-night',on?'1':'0');});

setInterval(()=>{
  localStorage.setItem('sha-mode',mode);
  if(mode==='hw'&&activeSid&&activeAid)localStorage.setItem('sha-last-hw',activeSid+'|'+activeAid);
  if(mode==='exam'&&activeESid&&activeEFid)localStorage.setItem('sha-last-exam',activeESid+'|'+activeEFid);
},2000);

(async function init(){
  await loadDB();
  const ls=document.getElementById('loading-screen');ls.classList.add('fade-out');setTimeout(()=>ls.style.display='none',520);
  const savedMode=localStorage.getItem('sha-mode');
  if(savedMode){
    mode=savedMode;applyMode();
    if(savedMode==='hw'){
      const last=localStorage.getItem('sha-last-hw');
      if(last){const[sid,aid]=last.split('|');if(getHW(sid,aid)){activeSid=sid;activeAid=aid;const s=getSub(sid);if(s)s.open=true;renderSidebar();renderHW();return;}}
    } else {
      const last=localStorage.getItem('sha-last-exam');
      if(last){const[sid,fid]=last.split('|');if(getEF(sid,fid)){activeESid=sid;activeEFid=fid;const s=getSub(sid);if(s)s.open=true;renderSidebar();renderExam();return;}}
    }
    renderSidebar();renderEmpty();
  } else {
    mode='hw';applyMode();showModeSelector();
  }
})();
</script>
</body>
</html>
